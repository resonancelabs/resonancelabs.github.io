!function(){const DEBUG=0;!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.cruntime=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={name:"rl-cruntime-browser",version:"0.3.2",main:"cruntime_browser.js",devDependencies:{"http-server":"^0.7.5"}}},{}],2:[function(require,module,exports){!function(){var crouton_thrift={};"undefined"==typeof crouton_thrift&&(crouton_thrift={}),crouton_thrift.KeyValue=function(args){if(this.Key=null,this.Value=null,args){if(void 0===args.Key)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field Key is unset!");if(this.Key=args.Key,void 0===args.Value)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field Value is unset!");this.Value=args.Value}},crouton_thrift.KeyValue.prototype={},crouton_thrift.KeyValue.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.Key=input.readString().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.STRING?this.Value=input.readString().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.KeyValue.prototype.write=function(output){output.writeStructBegin("KeyValue"),null!==this.Key&&void 0!==this.Key&&(output.writeFieldBegin("Key",Thrift.Type.STRING,1),output.writeString(this.Key),output.writeFieldEnd()),null!==this.Value&&void 0!==this.Value&&(output.writeFieldBegin("Value",Thrift.Type.STRING,2),output.writeString(this.Value),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.Runtime=function(args){this.guid=null,this.start_micros=null,this.group_name=null,this.attrs=null,args&&(void 0!==args.guid&&(this.guid=args.guid),void 0!==args.start_micros&&(this.start_micros=args.start_micros),void 0!==args.group_name&&(this.group_name=args.group_name),void 0!==args.attrs&&(this.attrs=args.attrs))},crouton_thrift.Runtime.prototype={},crouton_thrift.Runtime.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.guid=input.readString().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.start_micros=input.readI64().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.STRING?this.group_name=input.readString().value:input.skip(ftype);break;case 4:if(ftype==Thrift.Type.LIST){var _rtmp34,_size0=0;this.attrs=[];var _etype3=0;_rtmp34=input.readListBegin(),_etype3=_rtmp34.etype,_size0=_rtmp34.size;for(var _i5=0;_size0>_i5;++_i5){var elem6=null;elem6=new crouton_thrift.KeyValue,elem6.read(input),this.attrs.push(elem6)}input.readListEnd()}else input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.Runtime.prototype.write=function(output){if(output.writeStructBegin("Runtime"),null!==this.guid&&void 0!==this.guid&&(output.writeFieldBegin("guid",Thrift.Type.STRING,1),output.writeString(this.guid),output.writeFieldEnd()),null!==this.start_micros&&void 0!==this.start_micros&&(output.writeFieldBegin("start_micros",Thrift.Type.I64,2),output.writeI64(this.start_micros),output.writeFieldEnd()),null!==this.group_name&&void 0!==this.group_name&&(output.writeFieldBegin("group_name",Thrift.Type.STRING,3),output.writeString(this.group_name),output.writeFieldEnd()),null!==this.attrs&&void 0!==this.attrs){output.writeFieldBegin("attrs",Thrift.Type.LIST,4),output.writeListBegin(Thrift.Type.STRUCT,this.attrs.length);for(var iter7 in this.attrs)this.attrs.hasOwnProperty(iter7)&&(iter7=this.attrs[iter7],iter7.write(output));output.writeListEnd(),output.writeFieldEnd()}output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.Distribution=function(args){this.count=null,this.sum=null,this.std_dev=null,this.bucket_counts=null,this.bucket_growth_factor=null,this.max_sample_value=null,args&&(void 0!==args.count&&(this.count=args.count),void 0!==args.sum&&(this.sum=args.sum),void 0!==args.std_dev&&(this.std_dev=args.std_dev),void 0!==args.bucket_counts&&(this.bucket_counts=args.bucket_counts),void 0!==args.bucket_growth_factor&&(this.bucket_growth_factor=args.bucket_growth_factor),void 0!==args.max_sample_value&&(this.max_sample_value=args.max_sample_value))},crouton_thrift.Distribution.prototype={},crouton_thrift.Distribution.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.I64?this.count=input.readI64().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.sum=input.readI64().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.DOUBLE?this.std_dev=input.readDouble().value:input.skip(ftype);break;case 4:if(ftype==Thrift.Type.LIST){var _rtmp312,_size8=0;this.bucket_counts=[];var _etype11=0;_rtmp312=input.readListBegin(),_etype11=_rtmp312.etype,_size8=_rtmp312.size;for(var _i13=0;_size8>_i13;++_i13){var elem14=null;elem14=input.readI64().value,this.bucket_counts.push(elem14)}input.readListEnd()}else input.skip(ftype);break;case 5:ftype==Thrift.Type.DOUBLE?this.bucket_growth_factor=input.readDouble().value:input.skip(ftype);break;case 6:ftype==Thrift.Type.DOUBLE?this.max_sample_value=input.readDouble().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.Distribution.prototype.write=function(output){if(output.writeStructBegin("Distribution"),null!==this.count&&void 0!==this.count&&(output.writeFieldBegin("count",Thrift.Type.I64,1),output.writeI64(this.count),output.writeFieldEnd()),null!==this.sum&&void 0!==this.sum&&(output.writeFieldBegin("sum",Thrift.Type.I64,2),output.writeI64(this.sum),output.writeFieldEnd()),null!==this.std_dev&&void 0!==this.std_dev&&(output.writeFieldBegin("std_dev",Thrift.Type.DOUBLE,3),output.writeDouble(this.std_dev),output.writeFieldEnd()),null!==this.bucket_counts&&void 0!==this.bucket_counts){output.writeFieldBegin("bucket_counts",Thrift.Type.LIST,4),output.writeListBegin(Thrift.Type.I64,this.bucket_counts.length);for(var iter15 in this.bucket_counts)this.bucket_counts.hasOwnProperty(iter15)&&(iter15=this.bucket_counts[iter15],output.writeI64(iter15));output.writeListEnd(),output.writeFieldEnd()}null!==this.bucket_growth_factor&&void 0!==this.bucket_growth_factor&&(output.writeFieldBegin("bucket_growth_factor",Thrift.Type.DOUBLE,5),output.writeDouble(this.bucket_growth_factor),output.writeFieldEnd()),null!==this.max_sample_value&&void 0!==this.max_sample_value&&(output.writeFieldBegin("max_sample_value",Thrift.Type.DOUBLE,6),output.writeDouble(this.max_sample_value),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.LogRecord=function(args){this.timestamp_micros=null,this.runtime_guid=null,this.span_guid=null,this.stable_name=null,this.message=null,this.level=null,this.thread_id=null,this.filename=null,this.line_number=null,this.stack_frames=null,this.payload_json=null,this.error_flag=null,args&&(void 0!==args.timestamp_micros&&(this.timestamp_micros=args.timestamp_micros),void 0!==args.runtime_guid&&(this.runtime_guid=args.runtime_guid),void 0!==args.span_guid&&(this.span_guid=args.span_guid),void 0!==args.stable_name&&(this.stable_name=args.stable_name),void 0!==args.message&&(this.message=args.message),void 0!==args.level&&(this.level=args.level),void 0!==args.thread_id&&(this.thread_id=args.thread_id),void 0!==args.filename&&(this.filename=args.filename),void 0!==args.line_number&&(this.line_number=args.line_number),void 0!==args.stack_frames&&(this.stack_frames=args.stack_frames),void 0!==args.payload_json&&(this.payload_json=args.payload_json),void 0!==args.error_flag&&(this.error_flag=args.error_flag))},crouton_thrift.LogRecord.prototype={},crouton_thrift.LogRecord.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.I64?this.timestamp_micros=input.readI64().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.STRING?this.runtime_guid=input.readString().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.STRING?this.span_guid=input.readString().value:input.skip(ftype);break;case 4:ftype==Thrift.Type.STRING?this.stable_name=input.readString().value:input.skip(ftype);break;case 5:ftype==Thrift.Type.STRING?this.message=input.readString().value:input.skip(ftype);break;case 6:ftype==Thrift.Type.STRING?this.level=input.readString().value:input.skip(ftype);break;case 7:ftype==Thrift.Type.I64?this.thread_id=input.readI64().value:input.skip(ftype);break;case 8:ftype==Thrift.Type.STRING?this.filename=input.readString().value:input.skip(ftype);break;case 9:ftype==Thrift.Type.I64?this.line_number=input.readI64().value:input.skip(ftype);break;case 10:if(ftype==Thrift.Type.LIST){var _rtmp320,_size16=0;this.stack_frames=[];var _etype19=0;_rtmp320=input.readListBegin(),_etype19=_rtmp320.etype,_size16=_rtmp320.size;for(var _i21=0;_size16>_i21;++_i21){var elem22=null;elem22=input.readString().value,this.stack_frames.push(elem22)}input.readListEnd()}else input.skip(ftype);break;case 11:ftype==Thrift.Type.STRING?this.payload_json=input.readString().value:input.skip(ftype);break;case 12:ftype==Thrift.Type.BOOL?this.error_flag=input.readBool().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.LogRecord.prototype.write=function(output){if(output.writeStructBegin("LogRecord"),null!==this.timestamp_micros&&void 0!==this.timestamp_micros&&(output.writeFieldBegin("timestamp_micros",Thrift.Type.I64,1),output.writeI64(this.timestamp_micros),output.writeFieldEnd()),null!==this.runtime_guid&&void 0!==this.runtime_guid&&(output.writeFieldBegin("runtime_guid",Thrift.Type.STRING,2),output.writeString(this.runtime_guid),output.writeFieldEnd()),null!==this.span_guid&&void 0!==this.span_guid&&(output.writeFieldBegin("span_guid",Thrift.Type.STRING,3),output.writeString(this.span_guid),output.writeFieldEnd()),null!==this.stable_name&&void 0!==this.stable_name&&(output.writeFieldBegin("stable_name",Thrift.Type.STRING,4),output.writeString(this.stable_name),output.writeFieldEnd()),null!==this.message&&void 0!==this.message&&(output.writeFieldBegin("message",Thrift.Type.STRING,5),output.writeString(this.message),output.writeFieldEnd()),null!==this.level&&void 0!==this.level&&(output.writeFieldBegin("level",Thrift.Type.STRING,6),output.writeString(this.level),output.writeFieldEnd()),null!==this.thread_id&&void 0!==this.thread_id&&(output.writeFieldBegin("thread_id",Thrift.Type.I64,7),output.writeI64(this.thread_id),output.writeFieldEnd()),null!==this.filename&&void 0!==this.filename&&(output.writeFieldBegin("filename",Thrift.Type.STRING,8),output.writeString(this.filename),output.writeFieldEnd()),null!==this.line_number&&void 0!==this.line_number&&(output.writeFieldBegin("line_number",Thrift.Type.I64,9),output.writeI64(this.line_number),output.writeFieldEnd()),null!==this.stack_frames&&void 0!==this.stack_frames){output.writeFieldBegin("stack_frames",Thrift.Type.LIST,10),output.writeListBegin(Thrift.Type.STRING,this.stack_frames.length);for(var iter23 in this.stack_frames)this.stack_frames.hasOwnProperty(iter23)&&(iter23=this.stack_frames[iter23],output.writeString(iter23));output.writeListEnd(),output.writeFieldEnd()}null!==this.payload_json&&void 0!==this.payload_json&&(output.writeFieldBegin("payload_json",Thrift.Type.STRING,11),output.writeString(this.payload_json),output.writeFieldEnd()),null!==this.error_flag&&void 0!==this.error_flag&&(output.writeFieldBegin("error_flag",Thrift.Type.BOOL,12),output.writeBool(this.error_flag),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.TraceJoinId=function(args){if(this.TraceKey=null,this.Value=null,args){if(void 0===args.TraceKey)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field TraceKey is unset!");if(this.TraceKey=args.TraceKey,void 0===args.Value)throw new Thrift.TProtocolException(Thrift.TProtocolExceptionType.UNKNOWN,"Required field Value is unset!");this.Value=args.Value}},crouton_thrift.TraceJoinId.prototype={},crouton_thrift.TraceJoinId.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.TraceKey=input.readString().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.STRING?this.Value=input.readString().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.TraceJoinId.prototype.write=function(output){output.writeStructBegin("TraceJoinId"),null!==this.TraceKey&&void 0!==this.TraceKey&&(output.writeFieldBegin("TraceKey",Thrift.Type.STRING,1),output.writeString(this.TraceKey),output.writeFieldEnd()),null!==this.Value&&void 0!==this.Value&&(output.writeFieldBegin("Value",Thrift.Type.STRING,2),output.writeString(this.Value),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.SpanRecord=function(args){this.span_guid=null,this.runtime_guid=null,this.span_name=null,this.join_ids=null,this.oldest_micros=null,this.youngest_micros=null,this.attributes=null,this.deprecated_error_text=null,args&&(void 0!==args.span_guid&&(this.span_guid=args.span_guid),void 0!==args.runtime_guid&&(this.runtime_guid=args.runtime_guid),void 0!==args.span_name&&(this.span_name=args.span_name),void 0!==args.join_ids&&(this.join_ids=args.join_ids),void 0!==args.oldest_micros&&(this.oldest_micros=args.oldest_micros),void 0!==args.youngest_micros&&(this.youngest_micros=args.youngest_micros),void 0!==args.attributes&&(this.attributes=args.attributes),void 0!==args.deprecated_error_text&&(this.deprecated_error_text=args.deprecated_error_text))},crouton_thrift.SpanRecord.prototype={},crouton_thrift.SpanRecord.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.span_guid=input.readString().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.STRING?this.runtime_guid=input.readString().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.STRING?this.span_name=input.readString().value:input.skip(ftype);break;case 4:if(ftype==Thrift.Type.LIST){var _rtmp328,_size24=0;this.join_ids=[];var _etype27=0;_rtmp328=input.readListBegin(),_etype27=_rtmp328.etype,_size24=_rtmp328.size;for(var _i29=0;_size24>_i29;++_i29){var elem30=null;elem30=new crouton_thrift.TraceJoinId,elem30.read(input),this.join_ids.push(elem30)}input.readListEnd()}else input.skip(ftype);break;case 5:ftype==Thrift.Type.I64?this.oldest_micros=input.readI64().value:input.skip(ftype);break;case 6:ftype==Thrift.Type.I64?this.youngest_micros=input.readI64().value:input.skip(ftype);break;case 8:if(ftype==Thrift.Type.LIST){var _rtmp335,_size31=0;this.attributes=[];var _etype34=0;_rtmp335=input.readListBegin(),_etype34=_rtmp335.etype,_size31=_rtmp335.size;for(var _i36=0;_size31>_i36;++_i36){var elem37=null;elem37=new crouton_thrift.KeyValue,elem37.read(input),this.attributes.push(elem37)}input.readListEnd()}else input.skip(ftype);break;case 7:ftype==Thrift.Type.STRING?this.deprecated_error_text=input.readString().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.SpanRecord.prototype.write=function(output){if(output.writeStructBegin("SpanRecord"),null!==this.span_guid&&void 0!==this.span_guid&&(output.writeFieldBegin("span_guid",Thrift.Type.STRING,1),output.writeString(this.span_guid),output.writeFieldEnd()),null!==this.runtime_guid&&void 0!==this.runtime_guid&&(output.writeFieldBegin("runtime_guid",Thrift.Type.STRING,2),output.writeString(this.runtime_guid),output.writeFieldEnd()),null!==this.span_name&&void 0!==this.span_name&&(output.writeFieldBegin("span_name",Thrift.Type.STRING,3),output.writeString(this.span_name),output.writeFieldEnd()),null!==this.join_ids&&void 0!==this.join_ids){output.writeFieldBegin("join_ids",Thrift.Type.LIST,4),output.writeListBegin(Thrift.Type.STRUCT,this.join_ids.length);for(var iter38 in this.join_ids)this.join_ids.hasOwnProperty(iter38)&&(iter38=this.join_ids[iter38],iter38.write(output));output.writeListEnd(),output.writeFieldEnd()}if(null!==this.oldest_micros&&void 0!==this.oldest_micros&&(output.writeFieldBegin("oldest_micros",Thrift.Type.I64,5),output.writeI64(this.oldest_micros),output.writeFieldEnd()),null!==this.youngest_micros&&void 0!==this.youngest_micros&&(output.writeFieldBegin("youngest_micros",Thrift.Type.I64,6),output.writeI64(this.youngest_micros),output.writeFieldEnd()),null!==this.attributes&&void 0!==this.attributes){output.writeFieldBegin("attributes",Thrift.Type.LIST,8),output.writeListBegin(Thrift.Type.STRUCT,this.attributes.length);for(var iter39 in this.attributes)this.attributes.hasOwnProperty(iter39)&&(iter39=this.attributes[iter39],iter39.write(output));output.writeListEnd(),output.writeFieldEnd()}null!==this.deprecated_error_text&&void 0!==this.deprecated_error_text&&(output.writeFieldBegin("deprecated_error_text",Thrift.Type.STRING,7),output.writeString(this.deprecated_error_text),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.SpanWindowSummary=function(args){this.span_name=null,this.delta_micros=null,this.delta_distribution=null,this.span_exemplars=null,args&&(void 0!==args.span_name&&(this.span_name=args.span_name),void 0!==args.delta_micros&&(this.delta_micros=args.delta_micros),void 0!==args.delta_distribution&&(this.delta_distribution=args.delta_distribution),void 0!==args.span_exemplars&&(this.span_exemplars=args.span_exemplars))},crouton_thrift.SpanWindowSummary.prototype={},crouton_thrift.SpanWindowSummary.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.span_name=input.readString().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.delta_micros=input.readI64().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.STRUCT?(this.delta_distribution=new crouton_thrift.Distribution,this.delta_distribution.read(input)):input.skip(ftype);break;case 4:if(ftype==Thrift.Type.LIST){var _rtmp344,_size40=0;this.span_exemplars=[];var _etype43=0;_rtmp344=input.readListBegin(),_etype43=_rtmp344.etype,_size40=_rtmp344.size;for(var _i45=0;_size40>_i45;++_i45){var elem46=null;elem46=new crouton_thrift.SpanRecord,elem46.read(input),this.span_exemplars.push(elem46)}input.readListEnd()}else input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.SpanWindowSummary.prototype.write=function(output){if(output.writeStructBegin("SpanWindowSummary"),null!==this.span_name&&void 0!==this.span_name&&(output.writeFieldBegin("span_name",Thrift.Type.STRING,1),output.writeString(this.span_name),output.writeFieldEnd()),null!==this.delta_micros&&void 0!==this.delta_micros&&(output.writeFieldBegin("delta_micros",Thrift.Type.I64,2),output.writeI64(this.delta_micros),output.writeFieldEnd()),null!==this.delta_distribution&&void 0!==this.delta_distribution&&(output.writeFieldBegin("delta_distribution",Thrift.Type.STRUCT,3),this.delta_distribution.write(output),output.writeFieldEnd()),null!==this.span_exemplars&&void 0!==this.span_exemplars){output.writeFieldBegin("span_exemplars",Thrift.Type.LIST,4),output.writeListBegin(Thrift.Type.STRUCT,this.span_exemplars.length);for(var iter47 in this.span_exemplars)this.span_exemplars.hasOwnProperty(iter47)&&(iter47=this.span_exemplars[iter47],iter47.write(output));output.writeListEnd(),output.writeFieldEnd()}output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.EchoRequest=function(args){this.message=null,args&&void 0!==args.message&&(this.message=args.message)},crouton_thrift.EchoRequest.prototype={},crouton_thrift.EchoRequest.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.message=input.readString().value:input.skip(ftype);break;case 0:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.EchoRequest.prototype.write=function(output){output.writeStructBegin("EchoRequest"),null!==this.message&&void 0!==this.message&&(output.writeFieldBegin("message",Thrift.Type.STRING,1),output.writeString(this.message),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.EchoResponse=function(args){this.message=null,args&&void 0!==args.message&&(this.message=args.message)},crouton_thrift.EchoResponse.prototype={},crouton_thrift.EchoResponse.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 2:ftype==Thrift.Type.STRING?this.message=input.readString().value:input.skip(ftype);break;case 0:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.EchoResponse.prototype.write=function(output){output.writeStructBegin("EchoResponse"),null!==this.message&&void 0!==this.message&&(output.writeFieldBegin("message",Thrift.Type.STRING,2),output.writeString(this.message),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.RuntimeReportRequest=function(args){this.runtime=null,this.timestamp_micros=null,this.span_window_summaries=null,this.span_records=null,this.log_records=null,args&&(void 0!==args.runtime&&(this.runtime=args.runtime),void 0!==args.timestamp_micros&&(this.timestamp_micros=args.timestamp_micros),void 0!==args.span_window_summaries&&(this.span_window_summaries=args.span_window_summaries),void 0!==args.span_records&&(this.span_records=args.span_records),void 0!==args.log_records&&(this.log_records=args.log_records))},crouton_thrift.RuntimeReportRequest.prototype={},crouton_thrift.RuntimeReportRequest.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRUCT?(this.runtime=new crouton_thrift.Runtime,this.runtime.read(input)):input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.timestamp_micros=input.readI64().value:input.skip(ftype);break;case 3:if(ftype==Thrift.Type.LIST){var _rtmp352,_size48=0;this.span_window_summaries=[];var _etype51=0;_rtmp352=input.readListBegin(),_etype51=_rtmp352.etype,_size48=_rtmp352.size;for(var _i53=0;_size48>_i53;++_i53){var elem54=null;elem54=new crouton_thrift.SpanWindowSummary,elem54.read(input),this.span_window_summaries.push(elem54)}input.readListEnd()}else input.skip(ftype);break;case 4:if(ftype==Thrift.Type.LIST){var _rtmp359,_size55=0;this.span_records=[];var _etype58=0;_rtmp359=input.readListBegin(),_etype58=_rtmp359.etype,_size55=_rtmp359.size;for(var _i60=0;_size55>_i60;++_i60){var elem61=null;elem61=new crouton_thrift.SpanRecord,elem61.read(input),this.span_records.push(elem61)}input.readListEnd()}else input.skip(ftype);break;case 5:if(ftype==Thrift.Type.LIST){var _rtmp366,_size62=0;this.log_records=[];var _etype65=0;_rtmp366=input.readListBegin(),_etype65=_rtmp366.etype,_size62=_rtmp366.size;for(var _i67=0;_size62>_i67;++_i67){var elem68=null;elem68=new crouton_thrift.LogRecord,elem68.read(input),this.log_records.push(elem68)}input.readListEnd()}else input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.RuntimeReportRequest.prototype.write=function(output){if(output.writeStructBegin("RuntimeReportRequest"),null!==this.runtime&&void 0!==this.runtime&&(output.writeFieldBegin("runtime",Thrift.Type.STRUCT,1),this.runtime.write(output),output.writeFieldEnd()),null!==this.timestamp_micros&&void 0!==this.timestamp_micros&&(output.writeFieldBegin("timestamp_micros",Thrift.Type.I64,2),output.writeI64(this.timestamp_micros),output.writeFieldEnd()),null!==this.span_window_summaries&&void 0!==this.span_window_summaries){output.writeFieldBegin("span_window_summaries",Thrift.Type.LIST,3),output.writeListBegin(Thrift.Type.STRUCT,this.span_window_summaries.length);for(var iter69 in this.span_window_summaries)this.span_window_summaries.hasOwnProperty(iter69)&&(iter69=this.span_window_summaries[iter69],iter69.write(output));output.writeListEnd(),output.writeFieldEnd()}if(null!==this.span_records&&void 0!==this.span_records){output.writeFieldBegin("span_records",Thrift.Type.LIST,4),output.writeListBegin(Thrift.Type.STRUCT,this.span_records.length);for(var iter70 in this.span_records)this.span_records.hasOwnProperty(iter70)&&(iter70=this.span_records[iter70],iter70.write(output));output.writeListEnd(),output.writeFieldEnd()}if(null!==this.log_records&&void 0!==this.log_records){output.writeFieldBegin("log_records",Thrift.Type.LIST,5),output.writeListBegin(Thrift.Type.STRUCT,this.log_records.length);for(var iter71 in this.log_records)this.log_records.hasOwnProperty(iter71)&&(iter71=this.log_records[iter71],iter71.write(output));output.writeListEnd(),output.writeFieldEnd()}output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.RuntimeReportResponse=function(args){this.kill_cruntime=null,this.receive_micros=null,this.transmit_micros=null,args&&(void 0!==args.kill_cruntime&&(this.kill_cruntime=args.kill_cruntime),void 0!==args.receive_micros&&(this.receive_micros=args.receive_micros),void 0!==args.transmit_micros&&(this.transmit_micros=args.transmit_micros))},crouton_thrift.RuntimeReportResponse.prototype={},crouton_thrift.RuntimeReportResponse.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.BOOL?this.kill_cruntime=input.readBool().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.receive_micros=input.readI64().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.I64?this.transmit_micros=input.readI64().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.RuntimeReportResponse.prototype.write=function(output){output.writeStructBegin("RuntimeReportResponse"),null!==this.kill_cruntime&&void 0!==this.kill_cruntime&&(output.writeFieldBegin("kill_cruntime",Thrift.Type.BOOL,1),output.writeBool(this.kill_cruntime),output.writeFieldEnd()),null!==this.receive_micros&&void 0!==this.receive_micros&&(output.writeFieldBegin("receive_micros",Thrift.Type.I64,2),output.writeI64(this.receive_micros),output.writeFieldEnd()),null!==this.transmit_micros&&void 0!==this.transmit_micros&&(output.writeFieldBegin("transmit_micros",Thrift.Type.I64,3),output.writeI64(this.transmit_micros),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ProxyReportRequest=function(args){this.runtime=null,this.span_records=null,this.log_records=null,args&&(void 0!==args.runtime&&(this.runtime=args.runtime),void 0!==args.span_records&&(this.span_records=args.span_records),void 0!==args.log_records&&(this.log_records=args.log_records))},crouton_thrift.ProxyReportRequest.prototype={},crouton_thrift.ProxyReportRequest.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRUCT?(this.runtime=new crouton_thrift.Runtime,this.runtime.read(input)):input.skip(ftype);break;case 2:if(ftype==Thrift.Type.LIST){var _rtmp376,_size72=0;this.span_records=[];var _etype75=0;_rtmp376=input.readListBegin(),_etype75=_rtmp376.etype,_size72=_rtmp376.size;for(var _i77=0;_size72>_i77;++_i77){var elem78=null;elem78=new crouton_thrift.SpanRecord,elem78.read(input),this.span_records.push(elem78)}input.readListEnd()}else input.skip(ftype);break;case 3:if(ftype==Thrift.Type.LIST){var _rtmp383,_size79=0;this.log_records=[];var _etype82=0;_rtmp383=input.readListBegin(),_etype82=_rtmp383.etype,_size79=_rtmp383.size;for(var _i84=0;_size79>_i84;++_i84){var elem85=null;elem85=new crouton_thrift.LogRecord,elem85.read(input),this.log_records.push(elem85)}input.readListEnd()}else input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ProxyReportRequest.prototype.write=function(output){if(output.writeStructBegin("ProxyReportRequest"),null!==this.runtime&&void 0!==this.runtime&&(output.writeFieldBegin("runtime",Thrift.Type.STRUCT,1),this.runtime.write(output),output.writeFieldEnd()),null!==this.span_records&&void 0!==this.span_records){output.writeFieldBegin("span_records",Thrift.Type.LIST,2),output.writeListBegin(Thrift.Type.STRUCT,this.span_records.length);for(var iter86 in this.span_records)this.span_records.hasOwnProperty(iter86)&&(iter86=this.span_records[iter86],iter86.write(output));output.writeListEnd(),output.writeFieldEnd()}if(null!==this.log_records&&void 0!==this.log_records){output.writeFieldBegin("log_records",Thrift.Type.LIST,3),output.writeListBegin(Thrift.Type.STRUCT,this.log_records.length);for(var iter87 in this.log_records)this.log_records.hasOwnProperty(iter87)&&(iter87=this.log_records[iter87],iter87.write(output));output.writeListEnd(),output.writeFieldEnd()}output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ProxyReportResponse=function(args){this.kill_cruntime=null,this.receive_micros=null,this.transmit_micros=null,args&&(void 0!==args.kill_cruntime&&(this.kill_cruntime=args.kill_cruntime),void 0!==args.receive_micros&&(this.receive_micros=args.receive_micros),void 0!==args.transmit_micros&&(this.transmit_micros=args.transmit_micros))},crouton_thrift.ProxyReportResponse.prototype={},crouton_thrift.ProxyReportResponse.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.BOOL?this.kill_cruntime=input.readBool().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.receive_micros=input.readI64().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.I64?this.transmit_micros=input.readI64().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ProxyReportResponse.prototype.write=function(output){output.writeStructBegin("ProxyReportResponse"),null!==this.kill_cruntime&&void 0!==this.kill_cruntime&&(output.writeFieldBegin("kill_cruntime",Thrift.Type.BOOL,1),output.writeBool(this.kill_cruntime),output.writeFieldEnd()),null!==this.receive_micros&&void 0!==this.receive_micros&&(output.writeFieldBegin("receive_micros",Thrift.Type.I64,2),output.writeI64(this.receive_micros),
output.writeFieldEnd()),null!==this.transmit_micros&&void 0!==this.transmit_micros&&(output.writeFieldBegin("transmit_micros",Thrift.Type.I64,3),output.writeI64(this.transmit_micros),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.Auth=function(args){this.access_token=null,args&&void 0!==args.access_token&&(this.access_token=args.access_token)},crouton_thrift.Auth.prototype={},crouton_thrift.Auth.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRING?this.access_token=input.readString().value:input.skip(ftype);break;case 0:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.Auth.prototype.write=function(output){output.writeStructBegin("Auth"),null!==this.access_token&&void 0!==this.access_token&&(output.writeFieldBegin("access_token",Thrift.Type.STRING,1),output.writeString(this.access_token),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ServiceReportRequest=function(args){this.auth=null,this.runtime_report=null,this.proxy_report=null,args&&(void 0!==args.auth&&(this.auth=args.auth),void 0!==args.runtime_report&&(this.runtime_report=args.runtime_report),void 0!==args.proxy_report&&(this.proxy_report=args.proxy_report))},crouton_thrift.ServiceReportRequest.prototype={},crouton_thrift.ServiceReportRequest.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRUCT?(this.auth=new crouton_thrift.Auth,this.auth.read(input)):input.skip(ftype);break;case 2:ftype==Thrift.Type.STRUCT?(this.runtime_report=new crouton_thrift.RuntimeReportRequest,this.runtime_report.read(input)):input.skip(ftype);break;case 3:ftype==Thrift.Type.STRUCT?(this.proxy_report=new crouton_thrift.ProxyReportRequest,this.proxy_report.read(input)):input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ServiceReportRequest.prototype.write=function(output){output.writeStructBegin("ServiceReportRequest"),null!==this.auth&&void 0!==this.auth&&(output.writeFieldBegin("auth",Thrift.Type.STRUCT,1),this.auth.write(output),output.writeFieldEnd()),null!==this.runtime_report&&void 0!==this.runtime_report&&(output.writeFieldBegin("runtime_report",Thrift.Type.STRUCT,2),this.runtime_report.write(output),output.writeFieldEnd()),null!==this.proxy_report&&void 0!==this.proxy_report&&(output.writeFieldBegin("proxy_report",Thrift.Type.STRUCT,3),this.proxy_report.write(output),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ForceGCRequest=function(args){this.now_micros=null,args&&void 0!==args.now_micros&&(this.now_micros=args.now_micros)},crouton_thrift.ForceGCRequest.prototype={},crouton_thrift.ForceGCRequest.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.I64?this.now_micros=input.readI64().value:input.skip(ftype);break;case 0:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ForceGCRequest.prototype.write=function(output){output.writeStructBegin("ForceGCRequest"),null!==this.now_micros&&void 0!==this.now_micros&&(output.writeFieldBegin("now_micros",Thrift.Type.I64,1),output.writeI64(this.now_micros),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.EmptyStruct=function(args){},crouton_thrift.EmptyStruct.prototype={},crouton_thrift.EmptyStruct.prototype.read=function(input){for(input.readStructBegin();;){{var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype);ret.fid}if(ftype==Thrift.Type.STOP)break;input.skip(ftype),input.readFieldEnd()}input.readStructEnd()},crouton_thrift.EmptyStruct.prototype.write=function(output){output.writeStructBegin("EmptyStruct"),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.Timing=function(args){this.receive_micros=null,this.transmit_micros=null,args&&(void 0!==args.receive_micros&&(this.receive_micros=args.receive_micros),void 0!==args.transmit_micros&&(this.transmit_micros=args.transmit_micros))},crouton_thrift.Timing.prototype={},crouton_thrift.Timing.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.I64?this.receive_micros=input.readI64().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.transmit_micros=input.readI64().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.Timing.prototype.write=function(output){output.writeStructBegin("Timing"),null!==this.receive_micros&&void 0!==this.receive_micros&&(output.writeFieldBegin("receive_micros",Thrift.Type.I64,1),output.writeI64(this.receive_micros),output.writeFieldEnd()),null!==this.transmit_micros&&void 0!==this.transmit_micros&&(output.writeFieldBegin("transmit_micros",Thrift.Type.I64,2),output.writeI64(this.transmit_micros),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.SampleCount=function(args){this.oldest_micros=null,this.youngest_micros=null,this.count=null,args&&(void 0!==args.oldest_micros&&(this.oldest_micros=args.oldest_micros),void 0!==args.youngest_micros&&(this.youngest_micros=args.youngest_micros),void 0!==args.count&&(this.count=args.count))},crouton_thrift.SampleCount.prototype={},crouton_thrift.SampleCount.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.I64?this.oldest_micros=input.readI64().value:input.skip(ftype);break;case 2:ftype==Thrift.Type.I64?this.youngest_micros=input.readI64().value:input.skip(ftype);break;case 3:ftype==Thrift.Type.I64?this.count=input.readI64().value:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.SampleCount.prototype.write=function(output){output.writeStructBegin("SampleCount"),null!==this.oldest_micros&&void 0!==this.oldest_micros&&(output.writeFieldBegin("oldest_micros",Thrift.Type.I64,1),output.writeI64(this.oldest_micros),output.writeFieldEnd()),null!==this.youngest_micros&&void 0!==this.youngest_micros&&(output.writeFieldBegin("youngest_micros",Thrift.Type.I64,2),output.writeI64(this.youngest_micros),output.writeFieldEnd()),null!==this.count&&void 0!==this.count&&(output.writeFieldBegin("count",Thrift.Type.I64,3),output.writeI64(this.count),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ReportRequest=function(args){this.runtime=null,this.span_records=null,this.log_records=null,this.timestamp_offset_micros=null,this.discarded_log_record_samples=null,args&&(void 0!==args.runtime&&(this.runtime=args.runtime),void 0!==args.span_records&&(this.span_records=args.span_records),void 0!==args.log_records&&(this.log_records=args.log_records),void 0!==args.timestamp_offset_micros&&(this.timestamp_offset_micros=args.timestamp_offset_micros),void 0!==args.discarded_log_record_samples&&(this.discarded_log_record_samples=args.discarded_log_record_samples))},crouton_thrift.ReportRequest.prototype={},crouton_thrift.ReportRequest.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRUCT?(this.runtime=new crouton_thrift.Runtime,this.runtime.read(input)):input.skip(ftype);break;case 3:if(ftype==Thrift.Type.LIST){var _rtmp392,_size88=0;this.span_records=[];var _etype91=0;_rtmp392=input.readListBegin(),_etype91=_rtmp392.etype,_size88=_rtmp392.size;for(var _i93=0;_size88>_i93;++_i93){var elem94=null;elem94=new crouton_thrift.SpanRecord,elem94.read(input),this.span_records.push(elem94)}input.readListEnd()}else input.skip(ftype);break;case 4:if(ftype==Thrift.Type.LIST){var _rtmp399,_size95=0;this.log_records=[];var _etype98=0;_rtmp399=input.readListBegin(),_etype98=_rtmp399.etype,_size95=_rtmp399.size;for(var _i100=0;_size95>_i100;++_i100){var elem101=null;elem101=new crouton_thrift.LogRecord,elem101.read(input),this.log_records.push(elem101)}input.readListEnd()}else input.skip(ftype);break;case 5:ftype==Thrift.Type.I64?this.timestamp_offset_micros=input.readI64().value:input.skip(ftype);break;case 6:if(ftype==Thrift.Type.LIST){var _rtmp3106,_size102=0;this.discarded_log_record_samples=[];var _etype105=0;_rtmp3106=input.readListBegin(),_etype105=_rtmp3106.etype,_size102=_rtmp3106.size;for(var _i107=0;_size102>_i107;++_i107){var elem108=null;elem108=new crouton_thrift.SampleCount,elem108.read(input),this.discarded_log_record_samples.push(elem108)}input.readListEnd()}else input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ReportRequest.prototype.write=function(output){if(output.writeStructBegin("ReportRequest"),null!==this.runtime&&void 0!==this.runtime&&(output.writeFieldBegin("runtime",Thrift.Type.STRUCT,1),this.runtime.write(output),output.writeFieldEnd()),null!==this.span_records&&void 0!==this.span_records){output.writeFieldBegin("span_records",Thrift.Type.LIST,3),output.writeListBegin(Thrift.Type.STRUCT,this.span_records.length);for(var iter109 in this.span_records)this.span_records.hasOwnProperty(iter109)&&(iter109=this.span_records[iter109],iter109.write(output));output.writeListEnd(),output.writeFieldEnd()}if(null!==this.log_records&&void 0!==this.log_records){output.writeFieldBegin("log_records",Thrift.Type.LIST,4),output.writeListBegin(Thrift.Type.STRUCT,this.log_records.length);for(var iter110 in this.log_records)this.log_records.hasOwnProperty(iter110)&&(iter110=this.log_records[iter110],iter110.write(output));output.writeListEnd(),output.writeFieldEnd()}if(null!==this.timestamp_offset_micros&&void 0!==this.timestamp_offset_micros&&(output.writeFieldBegin("timestamp_offset_micros",Thrift.Type.I64,5),output.writeI64(this.timestamp_offset_micros),output.writeFieldEnd()),null!==this.discarded_log_record_samples&&void 0!==this.discarded_log_record_samples){output.writeFieldBegin("discarded_log_record_samples",Thrift.Type.LIST,6),output.writeListBegin(Thrift.Type.STRUCT,this.discarded_log_record_samples.length);for(var iter111 in this.discarded_log_record_samples)this.discarded_log_record_samples.hasOwnProperty(iter111)&&(iter111=this.discarded_log_record_samples[iter111],iter111.write(output));output.writeListEnd(),output.writeFieldEnd()}output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ReportResponse=function(args){this.commands=null,this.timing=null,args&&(void 0!==args.commands&&(this.commands=args.commands),void 0!==args.timing&&(this.timing=args.timing))},crouton_thrift.ReportResponse.prototype={},crouton_thrift.ReportResponse.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:if(ftype==Thrift.Type.LIST){var _rtmp3116,_size112=0;this.commands=[];var _etype115=0;_rtmp3116=input.readListBegin(),_etype115=_rtmp3116.etype,_size112=_rtmp3116.size;for(var _i117=0;_size112>_i117;++_i117){var elem118=null;elem118=new crouton_thrift.Command,elem118.read(input),this.commands.push(elem118)}input.readListEnd()}else input.skip(ftype);break;case 2:ftype==Thrift.Type.STRUCT?(this.timing=new crouton_thrift.Timing,this.timing.read(input)):input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ReportResponse.prototype.write=function(output){if(output.writeStructBegin("ReportResponse"),null!==this.commands&&void 0!==this.commands){output.writeFieldBegin("commands",Thrift.Type.LIST,1),output.writeListBegin(Thrift.Type.STRUCT,this.commands.length);for(var iter119 in this.commands)this.commands.hasOwnProperty(iter119)&&(iter119=this.commands[iter119],iter119.write(output));output.writeListEnd(),output.writeFieldEnd()}null!==this.timing&&void 0!==this.timing&&(output.writeFieldBegin("timing",Thrift.Type.STRUCT,2),this.timing.write(output),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.Command=function(args){this.disable=null,args&&void 0!==args.disable&&(this.disable=args.disable)},crouton_thrift.Command.prototype={},crouton_thrift.Command.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.BOOL?this.disable=input.readBool().value:input.skip(ftype);break;case 0:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.Command.prototype.write=function(output){output.writeStructBegin("Command"),null!==this.disable&&void 0!==this.disable&&(output.writeFieldBegin("disable",Thrift.Type.BOOL,1),output.writeBool(this.disable),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ReportingService_Report_args=function(args){this.auth=null,this.request=null,args&&(void 0!==args.auth&&(this.auth=args.auth),void 0!==args.request&&(this.request=args.request))},crouton_thrift.ReportingService_Report_args.prototype={},crouton_thrift.ReportingService_Report_args.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 1:ftype==Thrift.Type.STRUCT?(this.auth=new crouton_thrift.Auth,this.auth.read(input)):input.skip(ftype);break;case 2:ftype==Thrift.Type.STRUCT?(this.request=new crouton_thrift.ReportRequest,this.request.read(input)):input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ReportingService_Report_args.prototype.write=function(output){output.writeStructBegin("ReportingService_Report_args"),null!==this.auth&&void 0!==this.auth&&(output.writeFieldBegin("auth",Thrift.Type.STRUCT,1),this.auth.write(output),output.writeFieldEnd()),null!==this.request&&void 0!==this.request&&(output.writeFieldBegin("request",Thrift.Type.STRUCT,2),this.request.write(output),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ReportingService_Report_result=function(args){this.success=null,args&&void 0!==args.success&&(this.success=args.success)},crouton_thrift.ReportingService_Report_result.prototype={},crouton_thrift.ReportingService_Report_result.prototype.read=function(input){for(input.readStructBegin();;){var ret=input.readFieldBegin(),ftype=(ret.fname,ret.ftype),fid=ret.fid;if(ftype==Thrift.Type.STOP)break;switch(fid){case 0:ftype==Thrift.Type.STRUCT?(this.success=new crouton_thrift.ReportResponse,this.success.read(input)):input.skip(ftype);break;case 0:input.skip(ftype);break;default:input.skip(ftype)}input.readFieldEnd()}input.readStructEnd()},crouton_thrift.ReportingService_Report_result.prototype.write=function(output){output.writeStructBegin("ReportingService_Report_result"),null!==this.success&&void 0!==this.success&&(output.writeFieldBegin("success",Thrift.Type.STRUCT,0),this.success.write(output),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},crouton_thrift.ReportingServiceClient=function(input,output){this.input=input,this.output=output?output:input,this.seqid=0},crouton_thrift.ReportingServiceClient.prototype={},crouton_thrift.ReportingServiceClient.prototype.Report=function(auth,request,callback){return this.send_Report(auth,request,callback),callback?void 0:this.recv_Report()},crouton_thrift.ReportingServiceClient.prototype.send_Report=function(auth,request,callback){this.output.writeMessageBegin("Report",Thrift.MessageType.CALL,this.seqid);var args=new crouton_thrift.ReportingService_Report_args;if(args.auth=auth,args.request=request,args.write(this.output),this.output.writeMessageEnd(),!callback)return this.output.getTransport().flush();var self=this;this.output.getTransport().flush(!0,function(){var result=null;try{result=self.recv_Report()}catch(e){result=e}callback(result)})},crouton_thrift.ReportingServiceClient.prototype.recv_Report=function(){{var ret=this.input.readMessageBegin(),mtype=(ret.fname,ret.mtype);ret.rseqid}if(mtype==Thrift.MessageType.EXCEPTION){var x=new Thrift.TApplicationException;throw x.read(this.input),this.input.readMessageEnd(),x}var result=new crouton_thrift.ReportingService_Report_result;if(result.read(this.input),this.input.readMessageEnd(),null!==result.success)return result.success;throw"Report failed: unknown result"};var Thrift={Version:"1.0.0-dev",Type:{STOP:0,VOID:1,BOOL:2,BYTE:3,I08:3,DOUBLE:4,I16:6,I32:8,I64:10,STRING:11,UTF7:11,STRUCT:12,MAP:13,SET:14,LIST:15,UTF8:16,UTF16:17},MessageType:{CALL:1,REPLY:2,EXCEPTION:3,ONEWAY:4},objectLength:function(obj){var length=0;for(var k in obj)obj.hasOwnProperty(k)&&length++;return length},inherits:function(constructor,superConstructor,name){function F(){}F.prototype=superConstructor.prototype,constructor.prototype=new F,constructor.prototype.name=name||""}};Thrift.TException=function(message){this.message=message},Thrift.inherits(Thrift.TException,Error,"TException"),Thrift.TException.prototype.getMessage=function(){return this.message},Thrift.TApplicationExceptionType={UNKNOWN:0,UNKNOWN_METHOD:1,INVALID_MESSAGE_TYPE:2,WRONG_METHOD_NAME:3,BAD_SEQUENCE_ID:4,MISSING_RESULT:5,INTERNAL_ERROR:6,PROTOCOL_ERROR:7,INVALID_TRANSFORM:8,INVALID_PROTOCOL:9,UNSUPPORTED_CLIENT_TYPE:10},Thrift.TApplicationException=function(message,code){this.message=message,this.code="number"==typeof code?code:0},Thrift.inherits(Thrift.TApplicationException,Thrift.TException,"TApplicationException"),Thrift.TApplicationException.prototype.read=function(input){for(;;){var ret=input.readFieldBegin();if(ret.ftype==Thrift.Type.STOP)break;var fid=ret.fid;switch(fid){case 1:ret.ftype==Thrift.Type.STRING?(ret=input.readString(),this.message=ret.value):ret=input.skip(ret.ftype);break;case 2:ret.ftype==Thrift.Type.I32?(ret=input.readI32(),this.code=ret.value):ret=input.skip(ret.ftype);break;default:ret=input.skip(ret.ftype)}input.readFieldEnd()}input.readStructEnd()},Thrift.TApplicationException.prototype.write=function(output){output.writeStructBegin("TApplicationException"),this.message&&(output.writeFieldBegin("message",Thrift.Type.STRING,1),output.writeString(this.getMessage()),output.writeFieldEnd()),this.code&&(output.writeFieldBegin("type",Thrift.Type.I32,2),output.writeI32(this.code),output.writeFieldEnd()),output.writeFieldStop(),output.writeStructEnd()},Thrift.TApplicationException.prototype.getCode=function(){return this.code},Thrift.Transport=Thrift.TXHRTransport=function(url,options){this.url=url,this.wpos=0,this.rpos=0,this.useCORS=options&&options.useCORS,this.send_buf="",this.recv_buf=""},Thrift.TXHRTransport.prototype={getXmlHttpRequestObject:function(){try{return new XMLHttpRequest}catch(e1){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e2){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e3){}throw"Your browser doesn't support XHR."},flush:function(async,callback){var self=this;if(async&&!callback||void 0===this.url||""===this.url)return this.send_buf;var xreq=this.getXmlHttpRequestObject();if(xreq.overrideMimeType&&xreq.overrideMimeType("application/json"),callback&&(xreq.onreadystatechange=function(){var clientCallback=callback;return function(){4==this.readyState&&200==this.status&&(self.setRecvBuffer(this.responseText),clientCallback())}}()),xreq.open("POST",this.url,!!async),xreq.send(this.send_buf),!async||!callback){if(4!=xreq.readyState)throw"encountered an unknown ajax ready state: "+xreq.readyState;if(200!=xreq.status)throw"encountered a unknown request status: "+xreq.status;this.recv_buf=xreq.responseText,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0}},jqRequest:function(client,postData,args,recv_method){if("undefined"==typeof jQuery||"undefined"==typeof jQuery.Deferred)throw"Thrift.js requires jQuery 1.5+ to use asynchronous requests";var thriftTransport=this,jqXHR=jQuery.ajax({url:this.url,data:postData,type:"POST",cache:!1,contentType:"application/json",dataType:"text thrift",converters:{"text thrift":function(responseData){thriftTransport.setRecvBuffer(responseData);var value=recv_method.call(client);return value}},context:client,success:jQuery.makeArray(args).pop()});return jqXHR},setRecvBuffer:function(buf){this.recv_buf=buf,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return!0},open:function(){},close:function(){},read:function(len){var avail=this.wpos-this.rpos;if(0===avail)return"";var give=len;len>avail&&(give=avail);var ret=this.read_buf.substr(this.rpos,give);return this.rpos+=give,ret},readAll:function(){return this.recv_buf},write:function(buf){this.send_buf=buf},getSendBuffer:function(){return this.send_buf}},Thrift.TWebSocketTransport=function(url){this.__reset(url)},Thrift.TWebSocketTransport.prototype={__reset:function(url){this.url=url,this.socket=null,this.callbacks=[],this.send_pending=[],this.send_buf="",this.recv_buf="",this.rb_wpos=0,this.rb_rpos=0},flush:function(async,callback){var self=this;this.isOpen()?(this.socket.send(this.send_buf),this.callbacks.push(function(){var clientCallback=callback;return function(msg){self.setRecvBuffer(msg),clientCallback()}}())):this.send_pending.push({buf:this.send_buf,cb:callback})},__onOpen:function(){var self=this;this.send_pending.length>0&&(this.send_pending.forEach(function(elem){this.socket.send(elem.buf),this.callbacks.push(function(){var clientCallback=elem.cb;return function(msg){self.setRecvBuffer(msg),clientCallback()}}())}),this.send_pending=[])},__onClose:function(evt){this.__reset(this.url)},__onMessage:function(evt){this.callbacks.length&&this.callbacks.shift()(evt.data)},__onError:function(evt){this.socket.close()},setRecvBuffer:function(buf){this.recv_buf=buf,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return this.socket&&this.socket.readyState==this.socket.OPEN},open:function(){this.socket&&this.socket.readyState!=this.socket.CLOSED||(this.socket=new WebSocket(this.url),this.socket.onopen=this.__onOpen.bind(this),this.socket.onmessage=this.__onMessage.bind(this),this.socket.onerror=this.__onError.bind(this),this.socket.onclose=this.__onClose.bind(this))},close:function(){this.socket.close()},read:function(len){var avail=this.wpos-this.rpos;if(0===avail)return"";var give=len;len>avail&&(give=avail);var ret=this.read_buf.substr(this.rpos,give);return this.rpos+=give,ret},readAll:function(){return this.recv_buf},write:function(buf){this.send_buf=buf},getSendBuffer:function(){return this.send_buf}},Thrift.TJSONProtocol=Thrift.Protocol=function(transport){this.tstack=[],this.tpos=[],this.transport=transport},Thrift.Protocol.Type={},Thrift.Protocol.Type[Thrift.Type.BOOL]='"tf"',Thrift.Protocol.Type[Thrift.Type.BYTE]='"i8"',Thrift.Protocol.Type[Thrift.Type.I16]='"i16"',Thrift.Protocol.Type[Thrift.Type.I32]='"i32"',Thrift.Protocol.Type[Thrift.Type.I64]='"i64"',Thrift.Protocol.Type[Thrift.Type.DOUBLE]='"dbl"',Thrift.Protocol.Type[Thrift.Type.STRUCT]='"rec"',Thrift.Protocol.Type[Thrift.Type.STRING]='"str"',Thrift.Protocol.Type[Thrift.Type.MAP]='"map"',Thrift.Protocol.Type[Thrift.Type.LIST]='"lst"',Thrift.Protocol.Type[Thrift.Type.SET]='"set"',Thrift.Protocol.RType={},Thrift.Protocol.RType.tf=Thrift.Type.BOOL,Thrift.Protocol.RType.i8=Thrift.Type.BYTE,Thrift.Protocol.RType.i16=Thrift.Type.I16,Thrift.Protocol.RType.i32=Thrift.Type.I32,Thrift.Protocol.RType.i64=Thrift.Type.I64,Thrift.Protocol.RType.dbl=Thrift.Type.DOUBLE,Thrift.Protocol.RType.rec=Thrift.Type.STRUCT,Thrift.Protocol.RType.str=Thrift.Type.STRING,Thrift.Protocol.RType.map=Thrift.Type.MAP,Thrift.Protocol.RType.lst=Thrift.Type.LIST,Thrift.Protocol.RType.set=Thrift.Type.SET,Thrift.Protocol.Version=1,Thrift.Protocol.prototype={getTransport:function(){return this.transport},writeMessageBegin:function(name,messageType,seqid){this.tstack=[],this.tpos=[],this.tstack.push([Thrift.Protocol.Version,'"'+name+'"',messageType,seqid])},writeMessageEnd:function(){var obj=this.tstack.pop();this.wobj=this.tstack.pop(),this.wobj.push(obj),this.wbuf="["+this.wobj.join(",")+"]",this.transport.write(this.wbuf)},writeStructBegin:function(name){this.tpos.push(this.tstack.length),this.tstack.push({})},writeStructEnd:function(){var p=this.tpos.pop(),struct=this.tstack[p],str="{",first=!0;for(var key in struct)first?first=!1:str+=",",str+=key+":"+struct[key];str+="}",this.tstack[p]=str},writeFieldBegin:function(name,fieldType,fieldId){this.tpos.push(this.tstack.length),this.tstack.push({fieldId:'"'+fieldId+'"',fieldType:Thrift.Protocol.Type[fieldType]})},writeFieldEnd:function(){var value=this.tstack.pop(),fieldInfo=this.tstack.pop();this.tstack[this.tstack.length-1][fieldInfo.fieldId]="{"+fieldInfo.fieldType+":"+value+"}",this.tpos.pop()},writeFieldStop:function(){},writeMapBegin:function(keyType,valType,size){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[keyType],Thrift.Protocol.Type[valType],0])},writeMapEnd:function(){var p=this.tpos.pop();if(p!=this.tstack.length){(this.tstack.length-p-1)%2!==0&&this.tstack.push("");var size=(this.tstack.length-p-1)/2;this.tstack[p][this.tstack[p].length-1]=size;for(var map="}",first=!0;this.tstack.length>p+1;){var v=this.tstack.pop(),k=this.tstack.pop();first?first=!1:map=","+map,isNaN(k)||(k='"'+k+'"'),map=k+":"+v+map}map="{"+map,this.tstack[p].push(map),this.tstack[p]="["+this.tstack[p].join(",")+"]"}},writeListBegin:function(elemType,size){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[elemType],size])},writeListEnd:function(){for(var p=this.tpos.pop();this.tstack.length>p+1;){var tmpVal=this.tstack[p+1];this.tstack.splice(p+1,1),this.tstack[p].push(tmpVal)}this.tstack[p]="["+this.tstack[p].join(",")+"]"},writeSetBegin:function(elemType,size){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[elemType],size])},writeSetEnd:function(){for(var p=this.tpos.pop();this.tstack.length>p+1;){var tmpVal=this.tstack[p+1];this.tstack.splice(p+1,1),this.tstack[p].push(tmpVal)}this.tstack[p]="["+this.tstack[p].join(",")+"]"},writeBool:function(value){this.tstack.push(value?1:0)},writeByte:function(i8){this.tstack.push(i8)},writeI16:function(i16){this.tstack.push(i16)},writeI32:function(i32){this.tstack.push(i32)},writeI64:function(i64){this.tstack.push(i64)},writeDouble:function(dbl){this.tstack.push(dbl)},writeString:function(str){if(null===str)this.tstack.push(null);else{for(var escapedString="",i=0;i<str.length;i++){var ch=str.charAt(i);escapedString+='"'===ch?'\\"':"\\"===ch?"\\\\":"\b"===ch?"\\b":"\f"===ch?"\\f":"\n"===ch?"\\n":"\r"===ch?"\\r":"	"===ch?"\\t":ch}this.tstack.push('"'+escapedString+'"')}},writeBinary:function(str){this.writeString(str)},readMessageBegin:function(){this.rstack=[],this.rpos=[],"undefined"!=typeof JSON&&"function"==typeof JSON.parse?this.robj=JSON.parse(this.transport.readAll()):"undefined"!=typeof jQuery?this.robj=jQuery.parseJSON(this.transport.readAll()):this.robj=eval(this.transport.readAll());var r={},version=this.robj.shift();if(version!=Thrift.Protocol.Version)throw"Wrong thrift protocol version: "+version;return r.fname=this.robj.shift(),r.mtype=this.robj.shift(),r.rseqid=this.robj.shift(),this.rstack.push(this.robj.shift()),r},readMessageEnd:function(){},readStructBegin:function(name){var r={};return r.fname="",this.rstack[this.rstack.length-1]instanceof Array&&this.rstack.push(this.rstack[this.rstack.length-1].shift()),r},readStructEnd:function(){this.rstack[this.rstack.length-2]instanceof Array&&this.rstack.pop()},readFieldBegin:function(){var r={},fid=-1,ftype=Thrift.Type.STOP;for(var f in this.rstack[this.rstack.length-1])if(null!==f){fid=parseInt(f,10),this.rpos.push(this.rstack.length);var field=this.rstack[this.rstack.length-1][fid];delete this.rstack[this.rstack.length-1][fid],this.rstack.push(field);break}if(-1!=fid)for(var i in this.rstack[this.rstack.length-1])null!==Thrift.Protocol.RType[i]&&(ftype=Thrift.Protocol.RType[i],this.rstack[this.rstack.length-1]=this.rstack[this.rstack.length-1][i]);return r.fname="",r.ftype=ftype,r.fid=fid,r},readFieldEnd:function(){for(var pos=this.rpos.pop();this.rstack.length>pos;)this.rstack.pop()},readMapBegin:function(){var map=this.rstack.pop(),first=map.shift();first instanceof Array&&(this.rstack.push(map),map=first,first=map.shift());var r={};return r.ktype=Thrift.Protocol.RType[first],r.vtype=Thrift.Protocol.RType[map.shift()],r.size=map.shift(),this.rpos.push(this.rstack.length),this.rstack.push(map.shift()),r},readMapEnd:function(){this.readFieldEnd()},readListBegin:function(){var list=this.rstack[this.rstack.length-1],r={};return r.etype=Thrift.Protocol.RType[list.shift()],r.size=list.shift(),this.rpos.push(this.rstack.length),this.rstack.push(list),r},readListEnd:function(){this.readFieldEnd()},readSetBegin:function(elemType,size){return this.readListBegin(elemType,size)},readSetEnd:function(){return this.readListEnd()},readBool:function(){var r=this.readI32();return null!==r&&"1"==r.value?r.value=!0:r.value=!1,r},readByte:function(){return this.readI32()},readI16:function(){return this.readI32()},readI32:function(f){void 0===f&&(f=this.rstack[this.rstack.length-1]);var r={};if(f instanceof Array)0===f.length?r.value=void 0:r.value=f.shift();else if(f instanceof Object){for(var i in f)if(null!==i){this.rstack.push(f[i]),delete f[i],r.value=i;break}}else r.value=f,this.rstack.pop();return r},readI64:function(){return this.readI32()},readDouble:function(){return this.readI32()},readString:function(){var r=this.readI32();return r},readBinary:function(){return this.readString()},skip:function(type){var ret,i;switch(type){case Thrift.Type.STOP:return null;case Thrift.Type.BOOL:return this.readBool();case Thrift.Type.BYTE:return this.readByte();case Thrift.Type.I16:return this.readI16();case Thrift.Type.I32:return this.readI32();case Thrift.Type.I64:return this.readI64();case Thrift.Type.DOUBLE:return this.readDouble();case Thrift.Type.STRING:return this.readString();case Thrift.Type.STRUCT:for(this.readStructBegin();;){if(ret=this.readFieldBegin(),ret.ftype==Thrift.Type.STOP)break;this.skip(ret.ftype),this.readFieldEnd()}return this.readStructEnd(),null;case Thrift.Type.MAP:for(ret=this.readMapBegin(),i=0;i<ret.size;i++)i>0&&this.rstack.length>this.rpos[this.rpos.length-1]+1&&this.rstack.pop(),this.skip(ret.ktype),this.skip(ret.vtype);return this.readMapEnd(),null;case Thrift.Type.SET:for(ret=this.readSetBegin(),i=0;i<ret.size;i++)this.skip(ret.etype);return this.readSetEnd(),null;case Thrift.Type.LIST:for(ret=this.readListBegin(),i=0;i<ret.size;i++)this.skip(ret.etype);return this.readListEnd(),null}}},Thrift.MultiplexProtocol=function(srvName,trans,strictRead,strictWrite){Thrift.Protocol.call(this,trans,strictRead,strictWrite),this.serviceName=srvName},Thrift.inherits(Thrift.MultiplexProtocol,Thrift.Protocol,"multiplexProtocol"),Thrift.MultiplexProtocol.prototype.writeMessageBegin=function(name,type,seqid){type===Thrift.MessageType.CALL||type===Thrift.MessageType.ONEWAY?Thrift.Protocol.prototype.writeMessageBegin.call(this,this.serviceName+":"+name,type,seqid):Thrift.Protocol.prototype.writeMessageBegin.call(this,name,type,seqid)},Thrift.Multiplexer=function(){this.seqid=0},Thrift.Multiplexer.prototype.createClient=function(serviceName,SCl,transport){SCl.Client&&(SCl=SCl.Client);var self=this;

SCl.prototype.new_seqid=function(){return self.seqid+=1,self.seqid};var client=new SCl(new Thrift.MultiplexProtocol(serviceName,transport));return client},Thrift.TXHRTransport.prototype.flush=function(async,callback){var self=this;if(async&&!callback||void 0===this.url||""===this.url)return this.send_buf;var xreq=this.getXmlHttpRequestObject();if(xreq.overrideMimeType&&xreq.overrideMimeType("application/json"),callback&&(xreq.onreadystatechange=function(){if(4==this.readyState){var err=200==this.status?!1:!0;self.setRecvBuffer(err?"http_status_not_200":this.responseText),callback()}}),xreq.open("POST",this.url,!!async),xreq.send(this.send_buf),!async||!callback){if(4!=xreq.readyState)throw"encountered an unknown ajax ready state: "+xreq.readyState;if(200!=xreq.status)throw"encountered a unknown request status: "+xreq.status;this.recv_buf=xreq.responseText,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0}},module.exports.crouton_thrift=crouton_thrift,module.exports.Thrift=Thrift}()},{}],3:[function(require,module,exports){function updateDebugOverlay(cr,enabled){enabled&&(gDebugOverlayEnabled||(gDebugOverlayEnabled=!0,cr.on("spans_recorded",function(spans){var i,link,div,opts=cr.options(),url="http://"+opts.service_host+":10001/",overlay=document.getElementById("traceguide_overlay");if(!overlay){overlay=document.createElement("div"),overlay.id="traceguide_overlay",overlay.style.position="fixed",overlay.style.bottom="0",overlay.style.right="0",overlay.style.width="240px",overlay.style.height="120px",overlay.style.padding="4px",overlay.style.border="solid 1px #FFF",overlay.style.backgroundColor="#0060a2",overlay.style.color="#FFF",overlay.style.fontSize="12px",overlay.style.fontFamily="sans-serif",overlay.style.opacity="0.7";var close=document.createElement("div");close.style["float"]="right",close.style.cursor="pointer",close.style.color="#FFF",close.onclick=function(evt){overlay.style.display="none"},close.innerHTML="X",overlay.appendChild(close),link=document.createElement("a"),link.href=url,link.style.color="#FFF",link.style.fontWeight="bold",link.appendChild(document.createTextNode("traceguide.io"));var title=document.createElement("div");title.appendChild(link),overlay.appendChild(title),document.body.appendChild(overlay)}var kMaxSpans=4,totalSpans=0;for(i=0;i<overlay.childNodes.length;i++){var child=overlay.childNodes[i];"traceguide_span"==child.className&&totalSpans++}if(!(totalSpans>kMaxSpans)){for(i=0;i<spans.length&&kMaxSpans>totalSpans;i++){var join_key="",join_url_val="";for(var key in spans[i].join_ids)spans[i].join_ids.hasOwnProperty(key)&&(""===join_key||"end_user_id"==key)&&(join_key=key,join_url_val=encodeURIComponent(spans[i].join_ids[key]));""!==join_key&&(div=document.createElement("div"),div.className="traceguide_span",link=document.createElement("a"),link.href=url+"trace/"+join_key+"?join_val="+join_url_val+"&at_micros="+spans[i].oldest_micros,link.style.color="#FFF",link.appendChild(document.createTextNode(spans[i].span_name)),div.appendChild(link),overlay.appendChild(div),totalSpans++)}i<spans.length-1&&(div=document.createElement("div"),div.className="traceguide_span",link=document.createElement("a"),link.href="#",link.style.color="#FFF",link.appendChild(document.createTextNode("...")),div.appendChild(link),overlay.appendChild(div))}})))}module.exports=function(cr){cr.on("options.set_debug",function(cr,enabled){updateDebugOverlay(cr,enabled)})};var gDebugOverlayEnabled=!1},{}],4:[function(require,module,exports){module.exports=function(cr){var attrs={};attrs.navigator_available=navigator?"true":"false",navigator&&(attrs.navigator_app_code_name=navigator.appCodeName,attrs.navigator_app_name=navigator.appName,attrs.navigator_app_version=navigator.appVersion,attrs.navigator_do_not_track=navigator.doNotTrack,attrs.navigator_language=navigator.language,attrs.navigator_languages=navigator.languages,attrs.navigator_platform=navigator.platform,attrs.navigator_product=navigator.product,attrs.navigator_product_sub=navigator.productSub,attrs.navigator_user_agent=navigator.userAgent,attrs.navigator_vendor=navigator.vendor,attrs.navigator_vendor_sub=navigator.vendorSub),attrs.screen_available=screen?"true":"false",screen&&(attrs.screen_width=screen.width,attrs.screen_height=screen.height),attrs.window_available=window?"true":"false",window&&(attrs.window_inner_width=window.innerWidth,attrs.window_inner_height=window.innerHeight),attrs.document_available=document?"true":"false",document&&(attrs.document_domain=document.domain,attrs.document_uri=document.documentURI,attrs.document_referrer=document.referrer,attrs.document_doctype=document.doctype);var memoryAvailable=window&&window.performance&&window.performance.memory;if(attrs.performance_memory_available=memoryAvailable?"true":"false",memoryAvailable){var mem=performance.memory;attrs.performance_memory_js_heap_size_limit=mem.jsHeapSizeLimit,attrs.performance_memory_total_js_heap_size=mem.totalJSHeapSize,attrs.performance_memory_used_js_heap_size=mem.usedJSHeapSize}cr.attributes(attrs)}},{}],5:[function(require,module,exports){function skipInstrumentation(cr){var status=cr.status();return!status.enabled||status.flushActive}function getResponseHeaders(xhr){var raw=xhr.getAllResponseHeaders();return raw.replace(/\r/g,"").replace(/^\s+/,"").replace(/\s+$/,"").split(/\n/)}var kMaxURLSnippetLength=64;module.exports=function(cr){if(window.XMLHttpRequest){var proxied={open:XMLHttpRequest.prototype.open,send:XMLHttpRequest.prototype.send};XMLHttpRequest.prototype.open=function(method,url){if(skipInstrumentation(cr))return proxied.open.apply(this,arguments);this.__cr_url=url,this.__cr_span=cr.span("XMLHttpRequest");var openPayload={arguments:Array.prototype.slice.call(arguments)};if(document&&document.cookie){for(var cookies=document.cookie.split(";"),data={},count=0,i=0;i<cookies.length;i++){var parts=cookies[i].split("=",2);if(2===parts.length){var key=parts[0].replace(/^\s+/,"").replace(/\s+$/,"");data[key]=decodeURIComponent(parts[1]),count++}}count>0&&(openPayload.cookies=data)}var message=arguments[1];message&&message.length>kMaxURLSnippetLength&&(message=message.substr(0,kMaxURLSnippetLength-1)+"…"),this.__cr_span.event("XMLHttpRequest.open",message,openPayload),this.addEventListener("readystatechange",function(){if(4==this.readyState){var responseType=this.responseType,payload={url:url,method:method,headers:getResponseHeaders(this),status:this.status,statusText:this.statusText,responseType:responseType},validResponseType=""===responseType||"text"==responseType;if(validResponseType&&this.responseText)try{payload.responseJSON=JSON.parse(this.responseText)}catch(e){payload.responseText=this.responseText}else payload.response=this.response;200!=this.status&&this.__cr_span.error("HTTP status error",this.status),this.__cr_span.event("XMLHttpRequest.readystate.done",payload),this.__cr_span.end()}else 2==this.readyState&&this.__cr_span.event("XMLHttpRequest.readystate.headers_received",{headers:getResponseHeaders(this)})});var result=proxied.open.apply(this,arguments);return result},XMLHttpRequest.prototype.send=function(arg){if(skipInstrumentation(cr))return proxied.send.apply(this,arguments);var data=Array.prototype.slice.call(arguments);if(1==data.length)try{data=JSON.parse(data[0])}catch(e){}return this.__cr_span.event("XMLHttpRequest.send",{url:this.__cr_url,data:data}),proxied.send.apply(this,arguments)}}}},{}],6:[function(require,module,exports){var kCreatePageViewSpan=!1;module.exports=function(cr){if(!document)return void cr.error("No document object available to cruntime");if(!window)return void cr.error("No window object available to cruntime");if(kCreatePageViewSpan){var spanPageView=cr.span("cr/page_view");spanPageView.event("cr/page_view",{url:document.URL})}document.addEventListener("DOMContentLoaded",function(event){cr.event("cr/dom_events/DOMContentLoaded",{url:document.URL})}),document.addEventListener("readystatechange",function(){cr.event("cr/dom_events/readystatechange",{ready_state:document.readyState})}),document.addEventListener("click",function(evt){var payload={clientX:evt.clientX,clientY:evt.clientY};if(evt.target){payload.target_id=evt.target.id,payload.class_name=evt.target.className,payload.tag_name=evt.target.tagName;for(var path=[payload.tag_name],elem=evt.target.parentNode;elem;)elem.tagName&&path.push(elem.tagName),elem=elem.parentNode;payload.path=path.reverse().join(">")}cr.event("cr/dom_events/click",payload)}),window.addEventListener("beforeunload",function(){cr.event("cr/dom_events/beforeunload"),kCreatePageViewSpan&&spanPageView.end(),performance&&performance.timing&&(cr.event("cr/performance/timing",performance.timing),cr.spanManual("cr/performance/page_response",1e3*performance.timing.navigationStart,1e3*performance.timing.responseEnd),cr.spanManual("cr/performance/page_load",1e3*performance.timing.navigationStart,1e3*performance.timing.domComplete)),cr.shutdown()}),window.addEventListener("unload",function(){cr.event("cr/dom_events/unload")})}},{}],7:[function(require,module,exports){function cookie(name,value,ttl,path,domain,secure){if(arguments.length>1){var newCookie=name+"="+encodeURIComponent(value)+(ttl?"; expires="+new Date(+new Date+1e3*ttl).toUTCString():"")+(path?"; path="+path:"")+(domain?"; domain="+domain:"")+(secure?"; secure":"");return document.cookie=newCookie,newCookie}return decodeURIComponent((("; "+document.cookie).split("; "+name+"=")[1]||"").split(";")[0])}var kCookieTimeToLiveSeconds=604800,lib={};lib.isNode=!1,lib.console=console,lib.nowMicros=function(){if(performance&&performance.now&&performance.timing&&performance.timing.navigationStart){var start=performance.timing.navigationStart;return function(){return 1e3*(start+performance.now())}}return function(){return 1e3*Date.now()}}(),lib.generateGUID=function(){return Math.floor(9007199254740992*Math.random()).toString(10)},lib.runtimeGUID=function(groupName){var cookieKey="traceguide_guid";groupName&&(cookieKey+="/"+groupName);var runtimeGUID=cookie(cookieKey);if(!runtimeGUID&&window&&window.__cr_override_runtime_guid&&(runtimeGUID=window.__cr_override_runtime_guid),!runtimeGUID){var sessionGUID=cookie("traceguide_session_guid");runtimeGUID=sessionGUID?sessionGUID:lib.generateGUID()}cookie(cookieKey,runtimeGUID,kCookieTimeToLiveSeconds,"/");var traceguideSessionIdKey="traceguide_session_id",traceguideSessionId=cookie(traceguideSessionIdKey);return traceguideSessionId||(traceguideSessionId="rt-"+runtimeGUID),cookie(traceguideSessionIdKey,traceguideSessionId,kCookieTimeToLiveSeconds,"/"),runtimeGUID},lib.localStore=function(key,value){return 2==arguments.length?void localStorage.setItem("traceguide/"+key,value):localStorage.getItem("traceguide/"+key)};var _console_obj=console,_console_log=console.log,_console_warn=console.warn,_console_error=console.error,base={log:function(args){return _console_log.apply(_console_obj,args)},warn:function(args){return _console_warn.apply(_console_obj,args)},error:function(args){return _console_error.apply(_console_obj,args)}};lib.logger={info:base.log,warn:base.warn,error:base.error,fatal:base.error},lib.abort=function(){throw new Error("Fatal exception")},lib.stackTrace=function(skip,unfiltered){var stack=(new Error).stack;if("string"==typeof stack){stack=stack.split("\n").slice(3);for(var i=0;i<stack.length;i++)stack[i]=stack[i].replace(/^\s*at\s+/,"");return stack}return void 0};var proxyFilename="<browser>";lib.setSourceUrl=function(url){if("string"==typeof url){var parts=url.split("/");proxyFilename=parts[parts.length-1]}},lib.defaultLogFilename=function(){return proxyFilename},module.exports=lib},{}],8:[function(require,module,exports){"function"!=typeof Object.create&&(Object.create=function(){var Temp=function(){};return function(prototype){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof prototype)throw TypeError("Argument must be an object");Temp.prototype=prototype;var result=new Temp;return Temp.prototype=null,result}}())},{}],9:[function(require,module,exports){var thrift_wrapper=require("./src/generated/crouton_thrift_all.js"),common=require("node/packages/rl-cruntime-common"),packageObject=require("./package.json"),platform=require("./src/platform_browser.js"),options=(require("./src/polyfill.js"),{paused:!1,cruntime_platform:packageObject.name,cruntime_version:packageObject.version,debug:!1}),scripts=document.getElementsByTagName("SCRIPT"),script=null;if(scripts.length>0){script=scripts[scripts.length-1];var dataPaused=script.dataset.paused;switch(dataPaused){case"true":case 1:options.paused=!0}var accessToken=script.dataset.access_token;"string"==typeof accessToken&&accessToken.length>0&&(options.access_token=accessToken);var groupName=script.dataset.group_name;"string"==typeof groupName&&groupName.length>0&&(options.group_name=groupName);var serviceHost=script.dataset.service_host;"string"==typeof serviceHost&&serviceHost.length>0&&(options.service_host=serviceHost);var servicePort=script.dataset.service_port;servicePort&&(options.service_port=parseInt(servicePort));var joinIds=script.dataset.join_ids;if(joinIds)try{options.join_ids=JSON.parse(joinIds)}catch(e){}var enabled=script.dataset.enabled;"string"==typeof enabled&&("true"==enabled?options.enabled=!0:"false"==enabled&&(options.enabled=!1));var debug=script.dataset.debug;"string"==typeof debug&&"true"==debug&&(options.debug=!0)}var state=common.createState({thriftTypes:thrift_wrapper.crouton_thrift,thriftLibrary:thrift_wrapper.Thrift,platform:platform,events:{preinitialize:function(cr){require("./src/initialize_debug_overlay.js")(cr)},postinitialize:function(cr){require("./src/initialize_runtime_attributes.js")(cr),require("./src/instrument_ajax.js")(cr),require("./src/instrument_document.js")(cr)},"options.set_group_name":function(cr){cr.options({join_ids:{traceguide_session_id:"rt-"+cr.guid()}})}}}),api=common.api(state);if(script){api.attributes({cruntime_source_url:script.src}),platform.setSourceUrl(script.src.replace(/\?.*$/,""));var globalName=script.dataset.global_name;"string"==typeof globalName&&globalName.length>0&&(window[globalName]=api)}api.initialize(options),module.exports=api},{"./package.json":1,"./src/generated/crouton_thrift_all.js":2,"./src/initialize_debug_overlay.js":3,"./src/initialize_runtime_attributes.js":4,"./src/instrument_ajax.js":5,"./src/instrument_document.js":6,"./src/platform_browser.js":7,"./src/polyfill.js":8,"node/packages/rl-cruntime-common":10}],10:[function(require,module,exports){var State=require("./src/state.js"),lib={};lib.createState=function(opts){if(!opts.thriftTypes)throw new Error("opts.thriftTypes required");if(!opts.thriftLibrary)throw new Error("opts.thriftLibrary required");if(!opts.platform)throw new Error("opt.platform required");if("function"!=typeof opts.platform.nowMicros)throw new Error("nowMicros is a required platform function");if("function"!=typeof opts.platform.generateGUID)throw new Error("generateGUID is a required platform function");if("object"!=typeof opts.platform.console)throw new Error("console is not a valid platform object");if("function"!=typeof opts.platform.console.log)throw new Error("console.log is not a valid platform function");if("function"!=typeof opts.platform.console.warn)throw new Error("console.warn is not a valid platform function");if("function"!=typeof opts.platform.console.error)throw new Error("console.error is not a valid platform function");if("function"!=typeof opts.platform.localStore)throw new Error("console.localStore is not a valid platform function");return new State(opts.thriftTypes,opts.thriftLibrary,opts.platform,opts.events)},lib.api=require("./src/api.js"),module.exports=lib},{"./src/api.js":11,"./src/state.js":15}],11:[function(require,module,exports){var imp=null,lib={};lib.initialize=function(){return imp.initialize.apply(imp,arguments)},lib.shutdown=function(){return imp.shutdown.apply(imp,arguments)},lib.options=function(){return imp.options.apply(imp,arguments)},lib.attributes=function(){return imp.runtimeAttributes.apply(imp,arguments)},lib.guid=function(){return imp.runtimeGUID()},lib.enabled=function(){return imp.getEnabled()},lib.verbose=function(){return imp.getVerbose()},lib.status=function(){return imp.getStatus()},lib.log=function(){return imp.logArgumentsInfo(arguments)},lib.info=function(){return imp.logArgumentsInfo(arguments)},lib.warn=function(){return imp.logArgumentsWarn(arguments)},lib.error=function(){return imp.logArgumentsError(arguments)},lib.fatal=function(){return imp.logArgumentsFatal(arguments)},lib.logf=function(){return imp.logFormattedInfo(arguments)},lib.infof=function(){return imp.logFormattedInfo(arguments)},lib.warnf=function(){return imp.logFormattedWarn(arguments)},lib.errorf=function(){return imp.logFormattedError(arguments)},lib.fatalf=function(){return imp.logFormattedFatal(arguments)},lib.plain={},lib.plain.log=function(){return imp.plainLog.apply(this,arguments)},lib.plain.warn=function(){return imp.plainWarn.apply(this,arguments)},lib.plain.error=function(){return imp.plainError.apply(this,arguments)},lib.v1={},lib.v1.log=function(){return imp.verbose()?lib.log.apply(lib,arguments):void 0},lib.v1.info=function(){return imp.verbose()?lib.info.apply(lib,arguments):void 0},lib.v1.warn=function(){return imp.verbose()?lib.warn.apply(lib,arguments):void 0},lib.v1.error=function(){return imp.verbose()?lib.error.apply(lib,arguments):void 0},lib.exception=function(e){return imp.logException(e)},lib.logRecord=function(){return imp.logRecord.apply(imp,arguments)},lib.event=function(){return imp.logEvent.apply(imp,arguments)},lib.eventWrap=function(){return imp.eventWrap.apply(imp,arguments)},lib.span=function(){return imp.span.apply(imp,arguments)},lib.spanWrap=function(){return imp.spanWrap.apply(imp,arguments)},lib.spanSection=function(){return imp.spanSection.apply(imp,arguments)},lib.spanManual=function(){return imp.spanManual.apply(imp,arguments)},lib.getActiveJoinIds=function(){return imp.getActiveJoinIds.apply(imp,arguments)},lib.setActiveJoinIds=function(){return imp.setActiveJoinIds.apply(imp,arguments)},lib.setActiveSpan=function(){return 2===arguments.length?imp.setActiveSpan.call(imp,arguments[0],null,[],arguments[1]):imp.setActiveSpan.apply(imp,arguments)},lib.counter=function(name,value){},lib.gauge=function(name,value){},lib.pause=function(){throw new Error("NOT_YET_IMPLEMENTED")},lib.resume=function(){throw new Error("NOT_YET_IMPLEMENTED")},lib.flush=function(synchronous,done){return imp.flushBuffer(synchronous,done)},lib.discard=function(){imp.discardBuffers()},lib.stats=function(){return imp.reportBufferStats()},lib.on=function(){return imp.on.apply(imp,arguments)},lib.removeListener=function(){return imp.removeListener.apply(imp,arguments)},lib.once=function(){return imp.once.apply(imp,arguments)},module.exports=function(implObject){return imp=implObject,imp.api=lib,lib.__imp=imp,lib}},{}],12:[function(require,module,exports){function ClockState(platform,state){this.platform=platform,this.state=state,this.samples=[],this.currentOffsetMicros=0,this.currentOffsetAge=kMaxOffsetAge+1;var storedData;try{this.state.options().service_host&&(storedData=JSON.parse(platform.localStore(kLocalStoreKey+"/"+state.options().service_host)))}catch(e){}var kStoredSamplesTTLMicros=36e8;if(storedData&&storedData.timestamp_micros&&storedData.timestamp_micros>platform.nowMicros()-kStoredSamplesTTLMicros)this.samples=storedData.samples.slice(-(kMaxOffsetAge+1));else for(var i=0;kMaxOffsetAge+1>i;i++)this.samples.push({delayMicros:Number.MAX_NUMBER,offsetMicros:0});this.update()}var kLocalStoreKey="clock_state",kMaxOffsetAge=7;ClockState.prototype.addSample=function(originMicros,receiveMicros,transmitMicros,destinationMicros){var latestDelayMicros=Number.MAX_NUMBER,latestOffsetMicros=0;originMicros>0&&receiveMicros>0&&transmitMicros>0&&destinationMicros>0&&(latestDelayMicros=destinationMicros-originMicros-(transmitMicros-receiveMicros),latestOffsetMicros=(receiveMicros-originMicros+(transmitMicros-destinationMicros))/2),this.samples.shift(),this.samples.push({delayMicros:latestDelayMicros,offsetMicros:latestOffsetMicros}),this.currentOffsetAge++,this.state.options().service_host&&this.platform.localStore(kLocalStoreKey+"/"+this.state.options().service_host,JSON.stringify({timestamp_micros:this.platform.nowMicros(),samples:this.samples})),this.update()},ClockState.prototype.update=function(){for(var minDelayMicros=Number.MAX_VALUE,bestOffsetMicros=0,i=0;i<this.samples.length;i++)this.samples[i].delayMicros<minDelayMicros&&(minDelayMicros=this.samples[i].delayMicros,bestOffsetMicros=this.samples[i].offsetMicros);if(bestOffsetMicros!=this.currentOffsetMicros){var jitter=0;for(i=0;i<this.samples.length;i++)jitter+=Math.pow(bestOffsetMicros-this.samples[i].offsetMicros,2);jitter=Math.sqrt(jitter/this.samples.length);var kSGATE=3;(this.currentOffsetAge>kMaxOffsetAge||Math.abs(this.currentOffsetMicros-bestOffsetMicros)<kSGATE*jitter)&&(this.currentOffsetMicros=bestOffsetMicros,this.currentOffsetAge=0)}},ClockState.prototype.offsetMicros=function(){return 0|this.currentOffsetMicros},module.exports=ClockState},{}],13:[function(require,module,exports){function ObjectPool(opts){var reserveCount=opts.reserve||32;this._ctor=opts.constructor,this._reset=opts.object_reset,this._pop_front=opts.pop_front||!1,this.allocationCount=0,this.acquireCount=0,this.releaseCount=0,this.freeList=new Array(reserveCount);for(var i=0;reserveCount>i;i++)this.freeList[i]=this.newObject()}ObjectPool.prototype.newObject=function(){return this.allocationCount++,new this._ctor},ObjectPool.prototype.acquire=function(args){this.acquireCount++;var obj;return obj=this.freeList.length?this.freeList.pop():this.newObject(),this._reset(obj,args),obj},ObjectPool.prototype.release=function(obj){void 0!==obj&&null!==obj&&(this.releaseCount++,this._reset(obj),this.freeList.push(obj))},ObjectPool.prototype.reset=function(){this.allocationCount=0,this.acquireCount=0,this.releaseCount=0,this.freeList=[]},module.exports=ObjectPool},{}],14:[function(require,module,exports){function SpanHandle(state,record){this._record=record,this._state=state,this._id=gIdCounter++}function logUserError(state,text,args){state.rawLogRecord({level:"E",error_flag:!0,filename:"<span_handle>",message:text,stack_frames:state.stackTrace(),payload:{arguments:Array.prototype.slice.call(args)}})}function mergeTraceIds(parentArray,toMerge){for(var map={},i=0;i<parentArray.length;i++){var pair=parentArray[i];map[pair.TraceKey]=pair.Value}if(toMerge)for(var key in toMerge)map[key]=toMerge[key];return map}function NoOpHandle(){}var kSpanHandlesPoolInitialSize=32,ObjectPool=require("./object_pool.js"),pool={spanHandles:new ObjectPool({constructor:SpanHandle,initial_size:kSpanHandlesPoolInitialSize,object_reset:function(obj,args){this._record=null,this._state=null,this._id=0}})},gIdCounter=1,gActiveSpansById={};SpanHandle.prototype.valid=function(){return!!this._record},SpanHandle.prototype.end=function(){return this._record?void(null===this._record.youngest_micros?(this._record.youngest_micros=this._state.nowMicros(),this._state.pushSpanRecord(this._record),this._record=null,delete gActiveSpansById[this._id],pool.spanHandles.release(this)):logUserError(this._state,"Span closed twice")):void logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.guid=function(){return this._record?this._record.span_guid:(logUserError(this._state,"Invalid span handle",arguments),0)},SpanHandle.prototype.name=function(newName){return this._record?void 0===newName?this._record.span_name:void(this._record.span_name=newName):void logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.endWrap=function(f){var self=this;return function(){self.end();var r;try{r=f.apply(this,arguments)}catch(e){throw self.exception(e),e}return r}},SpanHandle.prototype.joinIds=function(joinIds){if(!this._record)return void logUserError(this._state,"Invalid span handle",arguments);if(void 0===joinIds){var map={};joinIds=this._record.join_ids;for(var i=0;i<joinIds.length;i++){var pair=joinIds[i];map[pair.TraceKey]=pair.Value}return map}this._record?this._state.mergeJoinIdMapIntoSpanRecord(this._record,joinIds):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.log=function(){this._record?this._state.logArgumentsInfo(arguments,this._record.span_guid):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.info=SpanHandle.prototype.log,SpanHandle.prototype.warn=function(){this._record?this._state.logArgumentsWarn(arguments,this._record.span_guid):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.error=function(){this._record?this._state.logArgumentsError(arguments,this._record.span_guid):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.fatal=function(){var guid;this._record?guid=this._record.span_guid:logUserError(this._state,"Invalid span handle",arguments),this._state.logArgumentsFatal(arguments,guid)},SpanHandle.prototype.logf=function(){this._record?this._state.logFormattedInfo(arguments,this._record.span_guid):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.infof=SpanHandle.prototype.logf,SpanHandle.prototype.warnf=function(){this._record?this._state.logFormattedWarn(arguments,this._record.span_guid):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.errorf=function(){this._record?this._state.logFormattedError(arguments,this._record.span_guid):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.fatalf=function(){var guid;this._record?guid=this._record.span_guid:logUserError(this._state,"Invalid span handle",arguments),this._state.logFormattedFatal(arguments,guid)},SpanHandle.prototype.exception=function(e){var guid;this._record?guid=this._record.span_guid:logUserError(this._state,"Invalid span handle",arguments),this._state.logException(arguments,guid)},SpanHandle.prototype.logRecord=function(fields){this._record?fields.span_guid=this._record.span_guid:logUserError(this._state,"Invalid span handle",arguments),this._state.logRecord(fields)},SpanHandle.prototype.event=function(name,message,payload){this._record?(2===arguments.length&&"object"==typeof message&&(payload=message,message=void 0),this._state.logEventWithGUID(name,message,payload,this._record.span_guid)):logUserError(this._state,"Invalid span handle",arguments)},SpanHandle.prototype.span=function(name,joinIdKeyValues,callthrough){2===arguments.length&&"function"==typeof joinIdKeyValues&&(callthrough=joinIdKeyValues,joinIdKeyValues=null);var inner,handle;if(this._record){var joinIds=mergeTraceIds(this._record.join_ids,joinIdKeyValues);inner=this._state.rawSpanBegin(name,joinIds),handle=this._state.createSpanHandle(inner),handle.event("cr/parent_span_guid",{parent_name:this._record.span_name,parent_guid:this._record.span_guid})}else logUserError(this._state,"Invalid span handle",arguments),inner=this._state.rawSpanBegin(name,joinIdKeyValues),handle=this._state.createSpanHandle(inner);return callthrough?this._state.setActiveSpan(handle,null,[handle],callthrough):handle},SpanHandle.prototype.spanSection=function(name,joinIdKeyValues,f){2===arguments.length&&(f=joinIdKeyValues,joinIdKeyValues={});var joinIds=mergeTraceIds(this._record.join_ids,joinIdKeyValues);return this._state.spanSection(name,joinIds,f)};for(var key in SpanHandle.prototype)NoOpHandle.prototype[key]=function(){};NoOpHandle.prototype.endWrap=function(f){return f},NoOpHandle.prototype.span=function(name,joinIdKeyValues,f){return this},NoOpHandle.prototype.spanSection=function(name,joinIdKeyValues,f){return 2===arguments.length&&(f=joinIdKeyValues),f()};var lib={};lib.acquire=function(state,record){var obj=pool.spanHandles.acquire();return SpanHandle.call(obj,state,record),gActiveSpansById[obj._id]=obj,obj},lib.activeSpanHandles=function(){var active=[];for(var id in gActiveSpansById)active.push(gActiveSpansById[id]);return active},lib.isSpanHandle=function(obj){return obj instanceof SpanHandle},module.exports=lib},{"./object_pool.js":13}],15:[function(require,module,exports){function _error(){return originalConsole_error.apply(originalConsole,arguments)}function initializeGlobals(state,crouton_thrift_,Thrift_,platform_){if(null!==singleton)throw new Error("State is intended to be a singleton.");singleton=state,platform=platform_,crouton_thrift=crouton_thrift_,Thrift=Thrift_,pool.logRecords=new ObjectPool({constructor:crouton_thrift.LogRecord,initial_size:kLogRecordsPoolInitialSize,object_reset:function(obj,args){crouton_thrift.LogRecord.call(obj,args)}}),pool.spanRecords=new ObjectPool({constructor:crouton_thrift.SpanRecord,initial_size:kSpanRecordsPoolInitialSize,object_reset:function(obj,args){crouton_thrift.SpanRecord.call(obj,args)}}),pool.traceJoinIds=new ObjectPool({constructor:crouton_thrift.TraceJoinId,initial_size:kTraceJoinIdPoolInitialSize,object_reset:function(obj,args){crouton_thrift.TraceJoinId.call(obj,args)}})}function releaseSpanRecord(span){if(span.join_ids)for(var j=0;j<span.join_ids.length;j++)pool.traceJoinIds.release(span.join_ids[j]);pool.spanRecords.release(span)}function releaseArrays(logs,spans){for(var i=0;i<logs.length;i++)pool.logRecords.release(logs[i]);for(i=0;i<spans.length;i++)releaseSpanRecord(spans[i])}function defaultServiceHost(){return"undefined"!=typeof window&&window.location&&"localhost"===window.location.hostname?"localhost":"traceguide-api.mttr.to"}function allElementsAreStrings(a){for(var i=0;i<a.length;i++)if("string"!=typeof a[i])return!1;return!0}function State(thriftTypes,thriftLibrary,platform,eventHandlers){EventEmitterMin.call(this),initializeGlobals(this,thriftTypes,thriftLibrary,platform);for(var key in eventHandlers)this.on(key,eventHandlers[key]);this.api=null,this.serviceHost=defaultServiceHost(),this.servicePort=platform.isNode?9998:9997,this.bufferMaxSpanRecords=kMaxSpanRecordsDefault,this.bufferMaxLogRecords=kMaxLogRecordsDefault,this.refreshIntervalMs=kRefreshIntervalMsDefault,this.logToStdio=!1,this.debug=!1,this.verbose=!1,this.runtime=new crouton_thrift.Runtime,this.runtime.guid="",this.runtime.group_name="",this.runtime.start_micros=platform.nowMicros(),this.client=null,this.auth=new crouton_thrift.Auth,this.connection=null,this.clockState=null,this.scrub=null,this.initialized=!1,this.shuttingDown=!1,this.connectionOk=!1,this.refreshLoopActive=!1,this.flushActive=!1,this.flushErrorCount=0,this.flushNonConnectErrorCount=0,this.flushTimer=null,this.cruntimeActive=0,this.activeSpanOrJoinIDsStack=[],this.enabled=!0,this.joinIds={},this.spans=[],this.logs=[],this.discardedLogSamples=new TimestampSamples(100,3),this.reusable={reportRequest:new crouton_thrift.ReportRequest,status:{}},this.stats={flush_calls:0,flush_with_no_data:0,flush_rpc_requests:0,flush_rpc_responses:0,flush_errors:0,flush_exceptions:0,discarded_log_records:0,discarded_span_records:0},this.invokeReport=null,this.thriftHttpErrorCallback=null,this.platform=platform,this.logger=null,this.processAbort=null,this.options({scrubber:null,override_console:!0,override_logger:null,override_abort:null})}function coerceString(obj,fieldName){var type=typeof obj[fieldName];"undefined"!==type&&"string"!==type&&(obj[fieldName]=""+obj[fieldName])}function isNumberOrUndefined(val){var type=typeof val;return"undefined"===type||"number"===type}function isBooleanOrUndefined(val){var type=typeof val;return"undefined"===type||"boolean"===type}function isStringOrUndefined(val){var type=typeof val;return"undefined"===type||"string"===type}var ObjectPool=require("./object_pool.js"),span_handle=require("./span_handle.js"),ClockState=require("./clock_state.js"),TimestampSamples=require("./timestamp_samples.js"),inspectify=require("node/packages/rl-inspectable-object"),scrubber=require("node/packages/rl-scrubber"),EventEmitterMin=require("node/packages/rl-eventemitter"),DEBUG=!0,kLogRecordsPoolInitialSize=128,kSpanRecordsPoolInitialSize=32,kTraceJoinIdPoolInitialSize=64,kMaxLogRecordsDefault=1024,kMaxSpanRecordsDefault=1024,kRefreshIntervalMsDefault=2500,kDiscardDataEveryNthFlushError=32,kResetConnectionEveryNthFlushError=10,kBaselineScrubberRules=[{
match:["keys","url_query_string"],op:"remove",key_prefixes:["traceguide_"]}],kDefaultScrubbersRules=[{match:"keys",op:"remove",keys:["password","api_key"]}],singleton=null,crouton_thrift=null,Thrift=null,pool={logRecords:null,spanRecords:null,traceJoinIds:null},platform=null,originalConsole=console,originalConsole_log=originalConsole.log,originalConsole_warn=originalConsole.warn,originalConsole_error=originalConsole.error;State.prototype=new EventEmitterMin,State.prototype.initialize=function(opts){return this.initialized?(this.options(opts),void this.startFlushBufferLoopIfPossible(opts)):(this.emit("preinitialize",this.api),this.options(opts),this.startFlushBufferLoopIfPossible(opts),this.initialized=!0,void this.emit("postinitialize",this.api))},State.prototype.startFlushBufferLoopIfPossible=function(opts){var paused=opts?opts.paused:!1;this.auth.access_token&&!paused&&this.ensureFlushBufferLoopStarted()},State.prototype.shutdown=function(){if(this.enabled){this.shuttingDown=!0,this.emit("shutdown");for(var spans=span_handle.activeSpanHandles(),i=0;i<spans.length;i++){var span=spans[i];span.error("Active span not closed before shutdown. Closing forcibly.",span.name()),span.end()}this.flushBuffer(!0)}},State.prototype.options=function(opts){var key,self=this;if(0===arguments.length)return{enable:this.enabled,access_token:this.auth.access_token,service_host:this.serviceHost,service_port:this.servicePort,group_name:this.runtime.group_name,join_ids:this.joinIds,max_log_records:this.bufferMaxLogRecords,max_span_records:this.bufferMaxSpanRecords,debug:this.debug,refresh_interval_millis:this.refreshIntervalMs};if("object"!=typeof opts&&this.logArgumentsError(["options called with a non-object argument"]),"undefined"!=typeof opts.enable&&(this.setEnabled(opts.enable),this.enabled||(opts.override_console=!1)),"string"==typeof opts.access_token&&(this.auth.access_token=opts.access_token),"string"==typeof opts.service_host&&(this.serviceHost=opts.service_host),opts.service_port){var port=parseInt(opts.service_port);this.servicePort=port}if("string"==typeof opts.group_name&&(this.runtime.group_name=opts.group_name,this.runtime.guid=String(this.platform.runtimeGUID(opts.group_name)),this.emit("options.set_group_name",this.api,this.runtime.group_name)),void 0!==opts.join_ids)for(key in opts.join_ids){var value=opts.join_ids[key];void 0!==value?this.joinIds[key]=value:delete this.joinIds[key]}if("number"==typeof opts.max_log_records?this.bufferMaxLogRecords=Math.max(opts.max_log_records,1):null===opts.max_log_records&&(this.bufferMaxLogRecords=kMaxLogRecordsDefault),"number"==typeof opts.max_span_records?this.bufferMaxSpanRecords=Math.max(opts.max_span_records,1):null===opts.max_span_records&&(this.bufferMaxSpanRecords=kMaxSpanRecordsDefault),"boolean"==typeof opts.debug&&(this.debug=opts.debug,this.emit("options.set_debug",this.api,this.debug)),"boolean"==typeof opts.verbose&&(this.verbose=opts.verbose),"boolean"==typeof opts.log_to_stdio&&(this.logToStdio=opts.log_to_stdio),void 0!==opts.override_console&&(opts.override_console===!0?(console.log=function(){!self.enabled||self.flushActive||self.cruntimeActive?originalConsole_log.apply(originalConsole,arguments):self.logArgumentsInfo.call(self,arguments,void 0,!0)},console.warn=function(){!self.enabled||self.flushActive||self.cruntimeActive?originalConsole_warn.apply(originalConsole,arguments):self.logArgumentsWarn.call(self,arguments,void 0,!0)},console.error=function(){!self.enabled||self.flushActive||self.cruntimeActive?originalConsole_error.apply(originalConsole,arguments):self.logArgumentsError.call(self,arguments,void 0,!0)}):(console.log=originalConsole_log,console.warn=originalConsole_warn,console.error=originalConsole_error)),"number"==typeof opts.refresh_interval_millis?this.refreshIntervalMs=Math.max(0,opts.refresh_interval_millis):null===opts.refresh_interval_millis&&(this.refreshIntervalMs=kRefreshIntervalMsDefault),null===opts.scrubber)this.scrub=scrubber.make({rules:[].concat(kBaselineScrubberRules,kDefaultScrubbersRules)});else if("object"==typeof opts.scrubber){var scrubberConfig={};for(key in opts.scrubber)scrubberConfig[key]=opts.scrubber[key];scrubberConfig.rules=kBaselineScrubberRules.concat(scrubberConfig.rules||[]),this.scrub=scrubber.make(scrubberConfig)}if("string"==typeof opts.cruntime_platform&&this.replaceOrAddRuntimeKeyValue("cruntime_platform",opts.cruntime_platform),"string"==typeof opts.cruntime_version&&this.replaceOrAddRuntimeKeyValue("cruntime_version",opts.cruntime_version),opts.reset_object_pools&&this.resetObjectPools(),void 0!==opts.override_abort&&("function"==typeof opts.override_abort?this.processAbort=opts.override_abort:this.processAbort=function(){return this.platform.abort()}),void 0!==opts.override_logger){var f=opts.override_logger;if("function"==typeof f){var g=function(args){return f(args.join(" "))};this.logger={info:g,warn:g,error:g,fatal:g}}else this.logger=this.platform.logger}void 0!==opts.override_report_rpc&&("function"==typeof opts.override_report_rpc?this.invokeReport=opts.override_report_rpc:this.client?this.invokeReport=this.createAsyncRPCAdapter(this.client.Report,crouton_thrift.ReportResponse):this.invokeReport=null)},State.prototype.nowMicros=function(){return this.platform.nowMicros()},State.prototype.generateGUID=function(){return this.platform.generateGUID()},State.prototype.stackTrace=function(){return this.platform.stackTrace()},State.prototype.defaultLogFilename=function(){return this.platform.defaultLogFilename()},State.prototype.replaceOrAddRuntimeKeyValue=function(key,value){var keyValue=new crouton_thrift.KeyValue;if(keyValue.Key=key,"string"!=typeof value)try{value=JSON.stringify(value)}catch(e){value=Object.prototype.toString.call(value)}keyValue.Value=value,this.runtime.attrs||(this.runtime.attrs=[]);for(var i=0;i<this.runtime.attrs.length;i++){var attr=this.runtime.attrs[i];if(attr.Key==key)break}this.runtime.attrs[i]=keyValue},State.prototype.runtimeAttributes=function(attrs){if("object"==typeof attrs)for(var key in attrs)this.replaceOrAddRuntimeKeyValue(key,attrs[key])},State.prototype.runtimeGUID=function(){return this.runtime.guid},State.prototype.setEnabled=function(enable){enable=!(!enable||("false"===enable?!0:!1)),this.enabled!==enable&&(this.enabled=enable,enable||this.discardBuffers())},State.prototype.getEnabled=function(){return this.enabled},State.prototype.getVerbose=function(){return this.verbose},State.prototype.getStatus=function(){var status=this.reusable.status;return status.enabled=this.enabled,status.flushActive=this.flushActive,status},State.prototype.flushBuffer=function(synchronous,done){var self=this;if(done=done||function(err){},this.stats.flush_calls++,!this.enabled)return done();if(this.flushActive)return done();if(!this.runtime.group_name)return done();if(!this.runtime.guid)return DEBUG&&_error("runtime.group_name is set but runtime.guid is invalid!"),done();if(0===this.logs.length&&0===this.spans.length)return this.stats.flush_with_no_data++,done();this.ensureClockStateInitialized(),this.ensureClientConnectionStarted(),synchronous=synchronous||!1;var timeOffsetMicros=this.clockState.offsetMicros();0!==timeOffsetMicros&&this.logEvent("cr/time_correction_state",{offset_micros:timeOffsetMicros});var i,guid=this.runtime.guid;for(i=0;i<this.logs.length;i++)this.logs[i].runtime_guid=guid;for(i=0;i<this.spans.length;i++)this.spans[i].runtime_guid=guid;var req=this.reusable.reportRequest;req.runtime=this.runtime,req.timestamp_offset_micros=timeOffsetMicros,req.span_records=this.spans,req.log_records=this.logs,req.discarded_log_record_samples=[];var bucketMag=this.discardedLogSamples.magnitude;for(var key in this.discardedLogSamples.buckets){var thrift_bucket=new crouton_thrift.SampleCount;thrift_bucket.oldest_micros=key*bucketMag,thrift_bucket.youngest_micros=thrift_bucket.oldest_micros+bucketMag,thrift_bucket.count=this.discardedLogSamples.buckets[key],req.discarded_log_record_samples.push(thrift_bucket)}this.flushActive=!0;var logs=this.logs,spans=this.spans;try{self.stats.flush_rpc_requests++;var origin_micros=self.nowMicros();this.invokeReport(synchronous,req,function(err,res){var destination_micros=self.nowMicros();self.stats.flush_rpc_responses++,self.flushActive=!1,err?(self.stats.flush_errors++,self.restoreRecordsAfterError(logs,spans)):(res&&(self.emitSpansRecordedEvent(spans,synchronous),res.kill_cruntime&&self.options({enable:!1}),res.timing&&res.timing.receive_micros&&res.timing.transmit_micros&&self.clockState.addSample(origin_micros,res.timing.receive_micros,res.timing.transmit_micros,destination_micros)),releaseArrays(logs,spans)),done(err)}),this.logs=[],this.spans=[],this.discardedLogSamples.clear()}catch(e){return self.stats.flush_exceptions++,this.flushActive&&(this.flushActive=!1),done(e)}},State.prototype.emitSpansRecordedEvent=function(spans,synchronous){if(spans&&0!==spans.length){var self=this;if(EventEmitterMin.listenerCount(self,"spans_recorded")){for(var eventSpans=[],i=0;i<spans.length;i++){for(var record=spans[i],join_ids={},j=0;j<record.join_ids.length;j++){var joinId=record.join_ids[j];join_ids[joinId.TraceKey]=joinId.Value}eventSpans.push({oldest_micros:record.oldest_micros,span_name:record.span_name,span_guid:record.span_guid,join_ids:join_ids})}synchronous?self.emit("spans_recorded",eventSpans):setTimeout(function(){self.emit("spans_recorded",eventSpans)},0)}}},State.prototype.restoreRecordsAfterError=function(logs,spans){function prependOffset(buffer,records,max){var space=max-buffer.length;return space>0?Math.max(0,records.length-space):records.length}var discard=!1,logOffset=prependOffset(this.logs,logs,this.bufferMaxLogRecords),logDiscard=[];logOffset<logs.length&&(logDiscard=logs.slice(0,logOffset),this.logs=logs.slice(logOffset).concat(this.logs),discard=!0);var spanOffset=prependOffset(this.spans,spans,this.bufferMaxSpanRecords),spanDiscard=[];spanOffset<spans.length&&(spanDiscard=spans.slice(0,spanOffset),this.spans=spans.slice(spanOffset).concat(this.spans),discard=!0),discard&&releaseArrays(logDiscard,spanDiscard)},State.prototype.ensureFlushBufferLoopStarted=function(){if(!this.refreshLoopActive){var self=this;this.refreshLoopActive=!0,function loop(){self.flushBuffer(!1,function(err){if(err?(self.flushErrorCount++,self.isNode&&"ECONNREFUSED"!=err.code&&(self.flushNonConnectErrorCount++,DEBUG&&_error("flushBuffer error:",err))):(self.flushErrorCount=0,self.flushNonConnectErrorCount=0),self.shuttingDown)clearTimeout(self.flushTimer);else{var backOff=Math.pow(2,Math.max(0,Math.min(8,self.flushErrorCount-2)));self.flushTimer=setTimeout(loop,backOff*self.refreshIntervalMs),"function"==typeof self.flushTimer.unref&&self.flushTimer.unref();var limit=kResetConnectionEveryNthFlushError;self.flushNonConnectErrorCount%(limit+1)==limit&&(_error("flushBuffer error limit reached: recreating client connection."),self.connectionOk=!1),limit=kDiscardDataEveryNthFlushError,self.flushNonConnectErrorCount%(limit+1)==limit&&(_error("flushBuffer error limit reached: discarding buffers."),self.discardBuffers())}})}()}},State.prototype.ensureClockStateInitialized=function(){this.clockState||(this.clockState=new ClockState(this.platform,this))},State.prototype.ensureClientConnectionStarted=function(){var self=this;if(!this.connectionOk){if(this.platform.isNode){var options={transport:Thrift.TBufferedTransport,protocol:Thrift.TBinaryProtocol,path:"/",https:!1};this.connection=Thrift.createHttpConnection(this.serviceHost,this.servicePort,options),this.client=Thrift.createHttpClient(crouton_thrift.ReportingServiceClient,this.connection),self.platform.patchHttpConnectionForSynchronousRPC(this.connection),this.connection.on("error",function(err){self.thriftHttpErrorCallback?self.thriftHttpErrorCallback(err):_error("Unhandled Thrift error:",err)})}else{var serviceUrl="https://"+this.serviceHost+":"+this.servicePort+"/",transport=new Thrift.Transport(serviceUrl),protocol=new Thrift.Protocol(transport);this.client=new crouton_thrift.ReportingServiceClient(protocol),this.connection=null}this.invokeReport||(this.invokeReport=this.createAsyncRPCAdapter(this.client.Report,crouton_thrift.ReportResponse)),this.connectionOk=!0}},State.prototype.createAsyncRPCAdapter=function(rpc,respType){var self=this;return this.platform.isNode?function(synchronous,req,callback){var errorHandlingCallback=function(){self.thriftHttpErrorCallback=null,callback.apply(this,arguments)};self.thriftHttpErrorCallback=errorHandlingCallback,self.connection.synchronousRPC=synchronous,rpc.call(self.client,self.auth,req,errorHandlingCallback)}:function(synchronous,req,callback){try{if(synchronous){var res=rpc.call(self.client,self.auth,req);return res instanceof respType?callback(null,res):callback(res,null)}rpc.call(self.client,self.auth,req,function(res){res instanceof respType?callback(null,res):callback(res,null)})}catch(e){return callback(e,null)}}},State.prototype.discardBuffers=function(){releaseArrays(this.logs,this.spans),this.logs=[],this.spans=[]},State.prototype.resetObjectPools=function(){this.logs=[],this.spans=[],pool.logRecords.reset(),pool.spanRecords.reset(),pool.traceJoinIds.reset()},State.prototype.plainLog=function(){return originalConsole_log.apply(originalConsole,arguments)},State.prototype.plainWarn=function(){return originalConsole_warn.apply(originalConsole,arguments)},State.prototype.plainError=function(){return originalConsole_error.apply(originalConsole,arguments)},State.prototype.rawLogRecord=function(fields){if(this.enabled){if(this.cruntimeActive++,coerceString(fields,"runtime_guid"),coerceString(fields,"span_guid"),coerceString(fields,"stable_name"),coerceString(fields,"message"),coerceString(fields,"filename"),!isStringOrUndefined(fields.level))return _error("Invalid log record: level",fields),void this.cruntimeActive--;if(!isNumberOrUndefined(fields.thread_id))return _error("Invalid log record: thread_id",fields),void this.cruntimeActive--;if(!isNumberOrUndefined(fields.line_number))return _error("Invalid log record: line_number",fields),void this.cruntimeActive--;if(!isStringOrUndefined(fields.payload_json))return _error("Invalid log record: payload_json",fields),void this.cruntimeActive--;if(!isBooleanOrUndefined(fields.error_flag))return _error("Invalid log record: error_flag",fields),void this.cruntimeActive--;try{if(fields.payload_json){try{fields.payload=JSON.parse(fields.payload_json)}catch(_ignored){}delete fields.payload_json}if(null!==fields.payload&&void 0!==fields.payload){var payload=inspectify(fields.payload);this.scrub&&(payload=this.scrub.modify(payload)),fields.payload_json=JSON.stringify(payload),fields.payload=null}}catch(payloadException){DEBUG&&(originalConsole.error("rl-cruntime exception: "+payloadException),originalConsole.error(payloadException.stack)),delete fields.payload,delete fields.payload_json}var record=pool.logRecords.acquire(fields);if(record.timestamp_micros=this.nowMicros(),this.logs.length>=this.bufferMaxLogRecords){var index=Math.floor(this.logs.length*Math.random()),recordToDiscard=this.logs[index];this.discardedLogSamples.add(recordToDiscard.timestamp_micros),pool.logRecords.release(recordToDiscard),this.logs[index]=record,this.stats.discarded_log_records++}else this.logs.push(record);this.cruntimeActive--}},State.prototype.logArgumentsWithSpanGUID=function(spanGUID,level,error,args){if(this.enabled){args=Array.prototype.slice.call(args);var payload={},hasPayload=!1;args.length>0&&!allElementsAreStrings(args)&&(payload.arguments=args,hasPayload=!0);var message;if(args.length){message=Object.prototype.toString.call(args[0]);for(var i=0;i<args.length;i++)message+=" "+Object.prototype.toString.call(args[i])}var record={error_flag:error?!0:!1,level:level,filename:this.defaultLogFilename(),message:message,span_guid:spanGUID};hasPayload&&(record.payload=payload),this.rawLogRecord(record)}},State.prototype.logArgumentsInfo=function(args,spanGUID,echo){this.enabled&&(void 0===echo&&(echo=this.logToStdio),args=Array.prototype.slice.call(args),this.logArgumentsWithSpanGUID(spanGUID,"I",!1,args),echo&&this.logger.info(args))},State.prototype.logArgumentsWarn=function(args,spanGUID,echo){this.enabled&&(void 0===echo&&(echo=this.logToStdio),args=Array.prototype.slice.call(args),this.logArgumentsWithSpanGUID(spanGUID,"W",!1,args),echo&&this.logger.warn(args))},State.prototype.logArgumentsError=function(args,spanGUID,echo){this.enabled&&(void 0===echo&&(echo=this.logToStdio),args=Array.prototype.slice.call(args),this.logArgumentsWithSpanGUID(spanGUID,"E",!0,args),echo&&this.logger.error(args))},State.prototype.logArgumentsFatal=function(args,spanGUID,echo){this.enabled&&(void 0===echo&&(echo=this.logToStdio),args=Array.prototype.slice.call(args),this.logArgumentsWithSpanGUID(spanGUID,"F",!0,args),echo&&this.logger.fatal(args),this.processAbort())},State.prototype.logFormattedInfo=function(args,spanGUID,echo){if(this.enabled)throw new Error("NOT_YET_IMPLEMENTED")},State.prototype.logFormattedWarn=function(args,spanGUID,echo){if(this.enabled)throw new Error("NOT_YET_IMPLEMENTED")},State.prototype.logFormattedError=function(args,spanGUID,echo){if(this.enabled)throw new Error("NOT_YET_IMPLEMENTED")},State.prototype.logFormattedFatal=function(args,spanGUID){if(this.enabled)throw new Error("NOT_YET_IMPLEMENTED")},State.prototype.logException=function(e,spanGUID){if(this.enabled&&!this.cruntimeActive){this.cruntimeActive++;var lineNumber,filename,stackFrames=[];if("string"==typeof e.stack&&(stackFrames=e.stack.split("\n"),stackFrames.length>=2)){var m,top=stackFrames[1];if(top.match(/^\s+at\s/)&&(m=top.match(/\((.+):([0-9]+):([0-9]+)\)$/))){filename=m[1];try{lineNumber=parseInt(m[2])}catch(ignored){}}}var exceptionType="Exception";e instanceof EvalError?exceptionType="EvalError":e instanceof RangeError?exceptionType="RangeError":e instanceof ReferenceError?exceptionType="ReferenceError":e instanceof SyntaxError?exceptionType="SyntaxError":e instanceof TypeError?exceptionType="TypeError":e instanceof URIError?exceptionType="URIError":e instanceof Error&&(exceptionType="Error"),this.rawLogRecord({span_guid:spanGUID,message:e.toString(),error_flag:!0,level:"E",filename:filename,line_number:lineNumber,payload:{exceptionType:exceptionType},stack_frames:stackFrames}),this.cruntimeActive--}},State.prototype.logRecord=function(fields){return this.enabled?this.rawLogRecord(fields):void 0},State.prototype.logEventWithGUID=function(name,message,payload,spanGUID){this.enabled&&this.rawLogRecord({stable_name:name,message:message,filename:this.defaultLogFilename(),payload:payload,span_guid:spanGUID})},State.prototype.logEvent=function(name,message,payload){return 2===arguments.length&&"object"==typeof message&&(payload=message,message=void 0),this.logEventWithGUID(name,message,payload,void 0)},State.prototype.eventWrap=function(name,f){var self=this;return function(){return this.enabled&&self.rawLogRecord({stable_name:name,filename:self.defaultLogFilename(),payload:{arguments:arguments,stack_frames:platform.stackTrace()}}),f.apply(this,arguments)}},State.prototype.setActiveSpanOrJoinIds=function(spanOrJoinIds,self,args,callthrough){if(!this.enabled)return callthrough.apply(self,args);spanOrJoinIds&&this.activeSpanOrJoinIDsStack.push(spanOrJoinIds);var ret;try{ret=callthrough.apply(self,args)}catch(e){throw this.logException(e),e}finally{spanOrJoinIds&&this.activeSpanOrJoinIDsStack.pop()}return ret},State.prototype.setActiveJoinIds=function(joinIds,callthrough){if(this.verbose){var filteredStack=this.platform.stackTrace(0,!1);this.logRecord({stable_name:"cr/set_active_join_ids",message:JSON.stringify(joinIds)+" "+filteredStack[0],payload:{join_ids:joinIds,active_join_ids:this.getActiveJoinIdsStack()},stack_frames:this.platform.stackTrace(0,!0)})}return this.setActiveSpanOrJoinIds(joinIds,null,[],callthrough)},State.prototype.setActiveSpan=function(span,self,args,callthrough){if(this.verbose){var filteredStack=this.platform.stackTrace(0,!1);this.logRecord({stable_name:"cr/set_active_span",message:span.name()+" "+JSON.stringify(span.joinIds())+" "+filteredStack[0],payload:{span_name:span.name(),span_guid:span.guid(),join_ids:span.joinIds(),active_join_ids:this.getActiveJoinIdsStack()},stack_frames:this.platform.stackTrace(0,!0)})}return this.setActiveSpanOrJoinIds(span,self,args,callthrough)},State.prototype.getActiveJoinIds=function(){if(!this.enabled)return{};for(var i=this.activeSpanOrJoinIDsStack.length-1;i>=0;i--){var span=this.activeSpanOrJoinIDsStack[i];if(!span_handle.isSpanHandle(span))return span;if(span.valid())return span.joinIds()}return{}},State.prototype.getActiveJoinIdsStack=function(){if(!this.enabled)return[];for(var stack=[],i=0;i<this.activeSpanOrJoinIDsStack.length;i++){var span=this.activeSpanOrJoinIDsStack[i];span_handle.isSpanHandle(span)?span.valid()&&stack.push(span.joinIds()):stack.push(span)}return stack},State.prototype.rawSpanBegin=function(name,joinIdKeyValues){if(!this.enabled)return null;var record=pool.spanRecords.acquire();return record.span_guid=platform.generateGUID(),record.runtime_guid=this.runtime.guid,record.span_name=name,record.oldest_micros=this.nowMicros(),record.youngest_micros=null,record.join_ids=[],this.mergeJoinIdMapIntoSpanRecord(record,joinIdKeyValues),this.verbose&&this.logRecord({stable_name:"cr/span_begin",message:name,payload:{name:name,guid:record.span_guid,explicit_join_ids:joinIdKeyValues,merged_join_ids:record.join_ids,join_id_stack:this.getActiveJoinIdsStack()},stack_frames:this.platform.stackTrace(0,!0)}),record},State.prototype.mergeJoinIdMapIntoSpanRecord=function(spanRecord,joinIdMap){if(joinIdMap){for(var replacedKeys={},i=0;i<spanRecord.join_ids.length;i++){var existingKey=spanRecord.join_ids[i].TraceKey;if(existingKey in joinIdMap){var newValue=joinIdMap[existingKey];replacedKeys[existingKey]=!0,spanRecord.join_ids[i].Value=String(newValue)}}for(var key in joinIdMap)if(void 0===replacedKeys[key]){var value=joinIdMap[key];if(void 0===value)continue;var joinId=pool.traceJoinIds.acquire();joinId.TraceKey=String(key),joinId.Value=String(value),spanRecord.join_ids.push(joinId)}}},State.prototype.createSpanHandle=function(spanRecord){return span_handle.acquire(this,spanRecord)},State.prototype.span=function(name,joinIdKeyValues,callthrough){2===arguments.length&&"function"==typeof joinIdKeyValues&&(callthrough=joinIdKeyValues,joinIdKeyValues=null);var activeJoinIds=this.getActiveJoinIds();for(var key in joinIdKeyValues)activeJoinIds[key]=joinIdKeyValues[key];joinIdKeyValues=activeJoinIds;var record=this.rawSpanBegin(name,joinIdKeyValues),handle=this.createSpanHandle(record);return callthrough?this.setActiveSpan(handle,null,[handle],callthrough):handle},State.prototype.spanWrap=function(name,joinIdKeyValues,f){var self=this;return 2==arguments.length&&(f=joinIdKeyValues,joinIdKeyValues={}),function(){var r,handle=self.span(name,joinIdKeyValues);try{r=f.apply(this,arguments)}catch(e){throw self.logException(e),e}finally{handle.end()}return r}},State.prototype.spanSection=function(name,joinIdKeyValues,f){2===arguments.length&&(f=joinIdKeyValues,joinIdKeyValues={});var r,handle=this.span(name,joinIdKeyValues);try{r=f()}catch(e){throw this.logException(e),e}finally{handle.end()}return r},State.prototype.spanManual=function(name,oldestMicros,youngestMicros){if(this.enabled){var record=this.rawSpanBegin(name);record.oldest_micros=oldestMicros,record.youngest_micros=youngestMicros,this.pushSpanRecord(record)}},State.prototype.pushSpanRecord=function(record){if(this.mergeJoinIdMapIntoSpanRecord(record,this.joinIds),this.spans.length>=this.bufferMaxSpanRecords){var index=Math.floor(this.spans.length*Math.random());releaseSpanRecord(this.spans[index]),this.spans[index]=record}else this.spans.push(record)},State.prototype.reportBufferStats=function(){var runtimeAttrs={};if(this.runtime.attrs)for(var i=0;i<this.runtime.attrs.length;i++){var attr=this.runtime.attrs[i];runtimeAttrs[attr.Key]=attr.Value}return{service_host:this.serviceHost,service_port:this.servicePort,runtime:this.runtime,auth:this.auth,runtime_attributes:runtimeAttrs,statistics:this.stats,queued_logs:this.logs.length,queued_spans:this.spans.length,max_log_records:this.bufferMaxLogRecords,max_span_records:this.bufferMaxSpanRecords,log_records_allocated:pool.logRecords.allocationCount,log_records_acquired:pool.logRecords.acquireCount,log_records_released:pool.logRecords.releaseCount,log_records_active:pool.logRecords.allocationCount-pool.logRecords.freeList.length,span_records_allocated:pool.spanRecords.allocationCount,span_records_acquired:pool.spanRecords.acquireCount,span_records_released:pool.spanRecords.releaseCount,span_records_active:pool.spanRecords.allocationCount-pool.spanRecords.freeList.length,join_ids_allocated:pool.traceJoinIds.allocationCount,join_ids_acquired:pool.traceJoinIds.acquireCount,join_ids_released:pool.traceJoinIds.releaseCount,join_ids_active:pool.traceJoinIds.allocationCount-pool.traceJoinIds.freeList.length}},module.exports=State},{"./clock_state.js":12,"./object_pool.js":13,"./span_handle.js":14,"./timestamp_samples.js":16,"node/packages/rl-eventemitter":17,"node/packages/rl-inspectable-object":18,"node/packages/rl-scrubber":20}],16:[function(require,module,exports){function TimestampSamples(maxBuckets,granularity){this.maxBuckets=maxBuckets,this.minMagnitude=Math.pow(10,granularity),this.clear()}TimestampSamples.prototype.clear=function(){this.buckets={},this.bucketCount=0,this.sampleCount=0,this.magnitude=this.minMagnitude},TimestampSamples.prototype.add=function(timestamp){var key=Math.floor(timestamp/this.magnitude);if(this.buckets[key])return this.buckets[key]++,void this.sampleCount++;if(this.bucketCount<this.maxBuckets)return this.buckets[key]=1,this.bucketCount++,void this.sampleCount++;var newBuckets={},newBucketCount=0;for(var bucketKey in this.buckets){var oldBucket=this.buckets[bucketKey],newKey=Math.floor(bucketKey/10);newBuckets[newKey]?newBuckets[newKey]+=oldBucket:(newBuckets[newKey]=oldBucket,newBucketCount++)}this.buckets=newBuckets,this.bucketCount=newBucketCount,this.magnitude*=10,this.add(timestamp)},TimestampSamples.prototype.bucketAt=function(timestamp){var key=Math.floor(timestamp/this.magnitude),bucket=this.buckets[key];return{min:key*this.magnitude,max:key*this.magnitude-1,count:bucket||0}},module.exports=TimestampSamples},{}],17:[function(require,module,exports){function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(evt,listener){var arr=this._listeners[evt];arr||(arr=this._listeners[evt]=[]),arr.push(listener)},EventEmitter.prototype.removeListener=function(evt,listener){var updated=[],existing=this._listeners[evt];if(existing){for(var i=0;i<existing.length;i++)existing[i]!=listener&&updated.push(existing[i]);this._listeners[evt]=updated}},EventEmitter.prototype.once=function(evt,listener){var self=this,wrapper=function(){listener.apply(self,arguments),self.removeListener(wrapper)};self.on(evt,wrapper)},EventEmitter.prototype.emit=function(evt){var listeners=this._listeners[evt];if(listeners)for(var args=Array.prototype.slice.call(arguments,1),list=this._listeners[evt],i=0;i<list.length;i++)list[i].apply(this,args)},EventEmitter.prototype.listeners=function(evt){return this._listeners[evt]},EventEmitter.listenerCount=function(emitter,evt){if(!emitter)return 0;var evtListeners=emitter.listeners(evt);return evtListeners?evtListeners.length:0},module.exports=EventEmitter},{}],18:[function(require,module,exports){module.exports=require("./src/process.js")},{"./src/process.js":19}],19:[function(require,module,exports){function isRegExp(obj){return"[object RegExp]"===Object.prototype.toString.call(obj)}function Processor(opts){this.opts=opts||{},this.valueCount=0,this.seen=[],this.limitValueCount=this.opts.limit_value_count||64,this.limitStringLength=this.opts.limit_string_length||512,this.limitArrayLength=this.opts.limit_array_length||24,this.arrayPeekLength=this.opts.array_peek_length||5}var isArray=function(){return Array.isArray?function(obj){return Array.isArray(obj)}:function(obj){return"[object Array]"===Object.prototype.toString.call(obj)}}();Processor.prototype.process=function(value,opts){return Processor.call(this,opts),this.processFastPath(value)?value:this.processSlowPath(value)},Processor.prototype.processFastPath=function(value){function isSimple(value,count){var type=typeof value;if("object"===type){if(-1!==seen.indexOf(value))return exceedsLimit;seen.push(value)}if("string"===type)return value.length>self.limitStringLength?exceedsLimit:count+1;if("number"===type)return value===1/0?exceedsLimit:value===-(1/0)?exceedsLimit:value!==value?exceedsLimit:count+1;if("function"===type)return exceedsLimit;if("object"!==type)return count+1;if(isArray(value)){if(count+value.length>limit)return exceedsLimit;var keyCount=0;for(var key in value)keyCount++;if(keyCount!==value.length)return exceedsLimit;for(var i=0;i<value.length;i++)if(count+=isSimple(count,value[i],limit),count>limit)return exceedsLimit;return count}var props=0;for(var key in value)props++;if(count+props>limit)return exceedsLimit;for(var key in value)if(count=isSimple(count,value[i],limit),count+props>limit)return exceedsLimit;return count}var self=this,limit=this.limitValueCount,exceedsLimit=limit+1,seen=[];if(isSimple(value,0)>limit)return!1;try{JSON.stringify(value)}catch(e){return!1}return!0},Processor.prototype.processSlowPath=function(value){return this.postProcessValue(this.processValue(value))},Processor.prototype.truncateString=function(value){var limit=this.limitStringLength;return value.length>limit&&(value=value.slice(0,limit-1)+"…"),value},Processor.prototype.postProcessValue=function(value){function enqueue(key,value,isObject){self.valueCount<valueLimit?(parents.push(value),indices.push(key),self.valueCount++):isObject&&delete value[key],self.valueCount===valueLimit&&(parents.push(value),indices.push("…"),value["…"]="<truncated>",self.valueCount++)}var valueLimit=this.limitValueCount,self=this,root={value:value},indices=["value"],parents=[root];for(this.valueCount++;parents.length;){var parent=parents.shift(),index=indices.shift(),value=parent[index];if("function"==typeof value&&(parent[index]=value=value()),"object"==typeof value)if(isArray(value))if(this.valueCount+value.length>=valueLimit)parent[index]=value=["<truncated>"],parents.push(value),indices.push(0);else for(var i=0;i<value.length;i++)enqueue(i,value,!0);else for(var key in value)value.hasOwnProperty(key)&&enqueue(key,value,!1)}return root.value},Processor.prototype.processValue=function(value){var self=this;switch(typeof value){case"undefined":return value;case"boolean":return value;case"string":return this.truncateString(value);case"number":return value===1/0?"<infinity>":value===-(1/0)?"<-infinity>":value!==value?"<NaN>":value;case"object":return null===value?value:isRegExp(value)?(value=this.truncateString(value.toString()),"<regexp: "+value+">"):-1!==this.seen.indexOf(value)?"<circular>":(this.seen.push(value),isArray(value)?value.length>this.limitArrayLength?function(){return{$type:"<truncated_array>",length:value.length,head:self.processValue(value.slice(0,self.arrayPeekLength)),tail:self.processValue(value.slice(value.length-self.arrayPeekLength))}}:function(){var keyCount=0;for(var k in value)keyCount++;if(keyCount==value.length){for(var a=new Array(value.length),i=0;i<value.length;i++)a[i]=self.processValue(value[i]);return a}return self.cloneKeyValues(value)}:function(){return self.cloneKeyValues(value)});case"function":return"<function>";case"symbol":return"<symbol>"}},Processor.prototype.cloneKeyValues=function(value){var obj={};for(var key in value){var elemType=typeof value[key];this.opts.exclude_functions&&"function"===elemType||(obj[key]=this.processValue(value[key]))}return obj};var gProcessor=new Processor;module.exports=function(value,opts){return gProcessor.process(value,opts)}},{}],20:[function(require,module,exports){module.exports=require("./src/scrubber.js")},{"./src/scrubber.js":23
}],21:[function(require,module,exports){var deepClone,deepDelete,deepExtend,deepFromFlat,deepKeys,deepMapValues,isPlainObject,mapKeys,mapValues,_;_=require("underscore"),module.exports={deepKeys:deepKeys=function(obj){if(!isPlainObject(obj))throw new Error("deepKeys must be called on an object, not '"+obj+"'");return _.flatten(_.map(obj,function(v,k){return isPlainObject(v)&&!_.isEmpty(v)?_.map(deepKeys(v),function(subkey){return""+k+"."+subkey}):[k]}))},deepClone:deepClone=function(object){var type,_i,_len,_ref;if(null==object)return object;for(_ref=[Date,Number,String,Boolean],_i=0,_len=_ref.length;_len>_i;_i++)if(type=_ref[_i],object instanceof type)return new type(object);return _(object).isArray()?_(object).map(deepClone):_(object).isObject()?object.nodeType&&_(object.cloneNode).isFunction()?object.cloneNode(!0):object.constructor!=={}.constructor?object:mapValues(object,deepClone):object},deepHas:function(obj,keys){var helper;return(helper=function(obj,keys){return 0!==keys.length&&_.isObject(obj)?1===keys.length?_.first(keys)in obj:helper(obj[_.first(keys)],_.rest(keys)):!1})(obj,_.isArray(keys)?keys:keys.split("."))},deepOmit:function(obj,keys){var deepOmitOne;if(!isPlainObject(obj))throw new Error("deepOmit must be called on an object, not '"+obj+"'");return deepOmitOne=function(obj,key){var helper;return(helper=function(obj,key_arr){switch(!1){case!_.isEmpty(key_arr):return obj;case 1!==key_arr.length:return _.omit(obj,_.first(key_arr));case!!isPlainObject(obj[_.first(key_arr)]):return obj;default:return _.extend({},obj,_.object([_.first(key_arr)],[helper(obj[_.first(key_arr)],_.rest(key_arr))]))}})(obj,key.split("."))},_.reduce(keys,deepOmitOne,obj)},deepPick:function(){var deepGet;return deepGet=function(obj,key){var helper;return(helper=function(obj,key_arr){return 1===key_arr.length?null!=obj?obj[_.first(key_arr)]:void 0:helper(obj[_.first(key_arr)],_.rest(key_arr))})(obj,key.split("."))},function(obj,keys){var flat_new_obj;if(!isPlainObject(obj))throw new Error("deepPick must be called on an object, not '"+obj+"'");return flat_new_obj=_.reduce(keys,function(new_obj,key){var val;return val=deepGet(obj,key),void 0!==val&&(new_obj[key]=val),new_obj},{}),deepFromFlat(flat_new_obj)}}(),deepDelete:deepDelete=function(obj,key){return null!=key&&null!=obj?(_(key).isArray()||(key=key.split(".")),1===key.length?void delete obj[key]:deepDelete(obj[key[0]],key.slice(1,key.length))):void 0},deepExtend:deepExtend=function(obj,ext,mutate){return _.reduce(ext,function(acc,val,key){return acc[key]=key in obj&&isPlainObject(obj[key])&&isPlainObject(val)?deepExtend(obj[key],val):val,acc},mutate?obj:_.clone(obj))},isPlainObject:isPlainObject=function(value){return(null!=value?value.constructor:void 0)==={}.constructor},deepToFlat:function(obj){var recurse,res;return res={},recurse=function(obj,current){var key,newKey,value,_results;_results=[];for(key in obj)value=obj[key],newKey=current?current+"."+key:key,_results.push(value&&isPlainObject(value)?recurse(value,newKey):res[newKey]=value);return _results},recurse(obj),res},deepFromFlat:deepFromFlat=function(o){var k,key,oo,part,parts,t;oo={},t=void 0,parts=void 0,part=void 0;for(k in o){for(t=oo,parts=k.split("."),key=parts.pop();parts.length;)part=parts.shift(),t=t[part]=t[part]||{};t[key]=o[k]}return oo},mapValues:mapValues=function(obj,f_val){if(!isPlainObject(obj))throw new Error("mapValues must be called on an object, not '"+obj+"'");return _.object(_.keys(obj),_.map(obj,f_val))},deepMapValues:deepMapValues=function(obj,f){if(!isPlainObject(obj))throw new Error("deepMapValues must be called on an object, not '"+obj+"'");return mapValues(obj,function(v,k){return isPlainObject(v)?deepMapValues(v,function(subv,subk){return f(subv,""+k+"."+subk)}):f(v,k)})},mapKeys:mapKeys=function(obj,f_val){if(!isPlainObject(obj))throw new Error("mapKeys must be called on an object, not '"+obj+"'");return _.object(_.map(obj,function(v,k){return f_val(k,v)}),_.values(obj))}}},{underscore:22}],22:[function(require,module,exports){(function(){function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&length>index;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;return arguments.length<3&&(memo=obj[keys?keys[index]:index],index+=dir),iterator(obj,iteratee,memo,keys,index,length)}}function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&length>index;index+=dir)if(predicate(array[index],index,array))return index;return-1}}function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return idx=sortedIndex(array,item),array[idx]===item?idx:-1;if(item!==item)return idx=predicateFind(slice.call(array,i,length),_.isNaN),idx>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&length>idx;idx+=dir)if(array[idx]===item)return idx;return-1}}function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)prop=nonEnumerableProps[nonEnumIdx],prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=function(value,context){return cb(value,context,1/0)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(2>length||null==obj)return obj;for(var index=1;length>index;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;l>i;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(collection){var length=getLength(collection);return"number"==typeof length&&length>=0&&MAX_ARRAY_INDEX>=length};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj))for(i=0,length=obj.length;length>i;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;length>i;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;length>index;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results},_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key;return key=isArrayLike(obj)?_.findIndex(obj,predicate,context):_.findKey(obj,predicate,context),void 0!==key&&-1!==key?obj[key]:void 0},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),("number"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-(1/0),lastComputed=-(1/0);if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],value>result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(computed>lastComputed||computed===-(1/0)&&result===-(1/0))&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],result>value&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(lastComputed>computed||computed===1/0&&result===1/0)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=isArrayLike(obj)?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;length>index;index++)rand=_.random(0,index),rand!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){for(var output=[],idx=0,i=startIndex||0,length=getLength(input);length>i;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){shallow||(value=flatten(value,shallow,strict));var j=0,len=value.length;for(output.length+=len;len>j;)output[idx++]=value[j++]}else strict||(output[idx++]=value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);length>i;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0))},_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);length>i;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;argsLength>j&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(arguments,!0,!0,1);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;length>index;index++)result[index]=_.pluck(array,index);return result},_.object=function(list,values){for(var result={},i=0,length=getLength(list);length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);for(var value=iteratee(obj),low=0,high=getLength(array);high>low;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;length>idx;idx++,start+=step)range[idx]=start;return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2),bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound},_.partial=function(func){var boundArgs=slice.call(arguments,1),bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;length>i;i++)args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound},_.bindAll=function(obj){var i,key,length=arguments.length;if(1>=length)throw new Error("bindAll must be passed function names");for(i=1;length>i;i++)key=arguments[i],obj[key]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),1>=times&&(func=null),memo}},_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var currentKey,keys=_.keys(obj),length=keys.length,results={},index=0;length>index;index++)currentKey=keys[index],results[currentKey]=iteratee(obj[currentKey],currentKey,obj);return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(key=keys[i],predicate(obj[key],key,obj))return key},_.pick=function(object,oiteratee,context){var iteratee,keys,result={},obj=object;if(null==obj)return result;_.isFunction(oiteratee)?(keys=_.allKeys(obj),iteratee=optimizeCb(oiteratee,context)):(keys=flatten(arguments,!1,!1,1),iteratee=function(value,key,obj){return key in obj},obj=Object(obj));for(var i=0,length=keys.length;length>i;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(flatten(arguments,!1,!1,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;length>i;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}aStack=aStack||[],bStack=bStack||[];for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if(length=a.length,length!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0};_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj?!0:isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;n>i;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property,fallback){var value=null==object?void 0:object[property];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result(this,func.apply(_,args))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],result(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this)},{}],23:[function(require,module,exports){function identityFunc(value){return value}function _startsWith(str,prefix){return str.substr(0,prefix.length)==prefix}function _endsWith(str,prefix){return str.substr(-prefix.length)==prefix}function keyMatchesRuleData(ruleData,fullKey,key){var i;if(ruleData.keySet[key])return!0;for(i=0;i<ruleData.keyPrefixes.length;i++)if(_startsWith(key,ruleData.keyPrefixes[i]))return!0;for(i=0;i<ruleData.keySuffixes.length;i++)if(_endsWith(key,ruleData.keySuffixes[i]))return!0;if(ruleData.pathSet[fullKey])return!0;for(i=0;i<ruleData.pathPrefixes.length;i++)if(_startsWith(key,ruleData.pathPrefixes[i]))return!0;for(i=0;i<ruleData.pathSuffixes.length;i++)if(_endsWith(key,ruleData.pathSuffixes[i]))return!0;for(i=0;i<ruleData.regularExpressions.length;i++)if(fullKey.match(ruleData.regularExpressions[i]))return!0;return!1}function buildRuleData(rule){var i,ruleData={keySet:{},keyPrefixes:[],keySuffixes:[],pathSet:{},pathPrefixes:[],pathSuffixes:[],regularExpressions:[]};if(rule.keys)for(i=0;i<rule.keys.length;i++)ruleData.keySet[rule.keys[i]]=!0;if(ruleData.keyPrefixes=rule.key_prefixes||[],ruleData.keySuffixes=rule.key_suffixes||[],rule.paths)for(i=0;i<rule.paths.length;i++)ruleData.pathSet[rule.paths[i]]=!0;if(ruleData.pathPrefixes=rule.path_prefixes||[],ruleData.pathSuffixes=rule.path_suffixes||[],rule.regular_expressions)for(i=0;i<rule.regular_expressions.length;i++)ruleData.regularExpressions.push(new RegExp(rule.regular_expressions[i]));return ruleData}function deepMapValuesOrDirectCall(obj,f){if(_.isArray(obj)){for(var i=0;i<obj.length;i++)obj[i]=deepMapValuesOrDirectCall(obj[i],f);return obj}return _.isObject(obj)?_.deepMapValues(obj,f):f(obj)}function deepRemoveKeys(obj,prefix,ruleData){if(_.isObject(obj)&&"function"!=typeof obj)for(var key in obj)obj.hasOwnProperty(key)&&(keyMatchesRuleData(ruleData,prefix+key,key)?delete obj[key]:deepRemoveKeys(obj[key],prefix+key+".",ruleData))}function deepReplaceValues(obj,prefix,ruleData,value){if(_.isObject(obj)&&"function"!=typeof obj)for(var key in obj)obj.hasOwnProperty(key)&&(keyMatchesRuleData(ruleData,prefix+key,key)?obj[key]=value:obj[key]!==key&&deepReplaceValues(obj[key],prefix+key+".",ruleData,value))}function generateFunctionForRule(rule){var ruleData=buildRuleData(rule);if("keys"==rule.match){if("remove"==rule.op)return function(value){return deepRemoveKeys(value,"",ruleData),value};if("replace"==rule.op)return function(value){return deepReplaceValues(value,"",ruleData,rule.value),value}}else if("url_query_string"==rule.match)return function(value){return deepMapValuesOrDirectCall(value,function(value){return _.isString(value)?processQueryStringValue(ruleData,value,rule.value):value})};throw new Error("Unsupported rule:\n"+JSON.stringify(rule,null,4))}function processQueryStringValue(ruleData,value,replacementRaw){if(-1===value.indexOf("="))return value;var replacementValue;void 0!==replacementRaw&&(replacementValue=encodeURIComponent(replacementRaw));var leading="",parts=value.split("?");parts.length>1&&(leading=parts.shift()+"?");var queryString=_.chain(parts.join("?").split("&")).map(function(param){var key,value,parts=param.split("=");try{key=decodeURIComponent(parts[0])}catch(_ignored){return param}return value=parts.slice(1).join("="),keyMatchesRuleData(ruleData,key,key)?void 0===replacementValue?"":parts[0]+"="+replacementValue:param}).filter(function(v){return v.length>0}).value().join("&");return leading+queryString;

}function Scrubber(cfg){cfg=cfg||defaultConfig,this._config=cfg,this._scrubFunc=identityFunc,this._configure(cfg)}var _=require("underscore");_.mixin(require("underscore.deep"));var defaultConfig={rules:[]};Scrubber.prototype._configure=function(cfg){if(cfg.rules.length){var rules=[];_.each(cfg.rules,function(rule){_.isArray(rule.match)?_.each(rule.match,function(match){var newRule=_.clone(rule);newRule.match=match,rules.push(newRule)}):rules.push(rule)});var funcs=_.map(rules,generateFunctionForRule);this._scrubFunc=_.compose.apply(_,funcs)}},Scrubber.prototype.copy=function(value){return this._scrubFunc(_.deepClone(value))},Scrubber.prototype.modify=function(value){return this._scrubFunc(value)};var lib={};lib.make=function(cfg){return new Scrubber(cfg)},module.exports=lib},{underscore:22,"underscore.deep":21}]},{},[9])(9)})}();